<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UniSync — Lecturer Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root{
          --bg-1:245 243 255;
          --bg-2:237 233 254;
          --surface:255 255 255;
          --card:234 231 251;
          --ink:26 26 31;
          --muted:99 102 106;
          --accent:167 139 250;
          --accent-2:139 92 246;
          --success:16 185 129;
          --warn:245 158 11;
          --danger:239 68 68;
          --ring:167 139 250;
        }
        .glass{backdrop-filter:blur(12px);background:rgba(255,255,255,.5)}
        .elevate{box-shadow:0 8px 24px rgba(0,0,0,.10)}
        .elevate-strong{box-shadow:0 16px 40px rgba(0,0,0,.18)}
        .animate-press{transition:transform .15s ease, opacity .15s ease}
        .ripple:active{transform:scale(0.98); opacity:0.9}
        @keyframes pulse{0%{transform:scale(1);opacity:.6}70%,100%{transform:scale(1.5);opacity:0}}
        .pulse-ring{position:relative}
        .pulse-ring::after{content:'';position:absolute;inset:-20px;border-radius:9999px;background:rgba(99,102,241,.3);animation:pulse 2s ease-out infinite;pointer-events:none}
        @keyframes slideInRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
        @keyframes slideOutRight{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}
        .alert-enter{animation:slideInRight 0.3s ease-out}
        .alert-exit{animation:slideOutRight 0.3s ease-in}
        .live-indicator{animation:pulse 2s infinite}
        @keyframes scanLine{0%{transform:translateY(-100%)}100%{transform:translateY(200px)}}
        .biometric-scan{position:relative;overflow:hidden}
        .biometric-scan::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgb(var(--accent-2)),transparent);animation:scanLine 2s ease-in-out infinite}
    </style>
</head>
<body class="h-full bg-[rgb(var(--bg-1))] bg-gradient-to-br from-[rgb(var(--bg-1))] to-[rgb(var(--bg-2))] text-[rgb(var(--ink))] antialiased" style="font-family: Roboto, system-ui, -apple-system, Segoe UI, Helvetica, Arial;">
<div class="min-h-screen flex items-center justify-center p-4">

    <!-- Android phone frame -->
    <div id="frame" class="w-full max-w-sm h-[820px] md:h-[860px] rounded-[32px] bg-[rgb(var(--surface))] border border-white/40 elevate overflow-hidden relative">
        <!-- Status spacer + camera hole -->
        <div class="relative h-6">
            <div class="absolute left-1/2 -translate-x-1/2 top-1 w-16 h-3 rounded-full bg-black/10"></div>
        </div>

        <!-- Top App Bar -->
        <header id="appHeader" class="hidden px-5 pt-2 pb-3 sticky top-0 z-30 bg-[rgb(var(--surface))]/90 glass">
            <div class="flex items-center justify-between">
                <button id="backBtn" class="p-2 rounded-full bg-[rgb(var(--card))] hover:opacity-90 animate-press ripple hidden" onclick="goBack()">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-2xl bg-[rgb(var(--accent-2))] text-white grid place-items-center font-semibold relative">
                        UL
                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-[rgb(var(--success))] rounded-full live-indicator"></div>
                    </div>
                    <div>
                        <div id="headerTitle" class="text-lg font-semibold tracking-tight leading-none">UniSync Lecturer</div>
                        <div class="text-[11px] text-black/50 flex items-center gap-1">
                            <span class="w-2 h-2 bg-[rgb(var(--success))] rounded-full live-indicator"></span>
                            Live Dashboard
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="btnBiometric" class="p-2 rounded-full bg-[rgb(var(--card))] hover:opacity-90 animate-press ripple" title="Biometric Auth" onclick="showBiometricAuth()">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 3 12.01 3c-1.98 0-3.86.47-5.57 1.41-.24.13-.54.04-.68-.2-.13-.24-.04-.55.2-.68C7.82 2.52 9.86 2 12.01 2c2.13 0 3.99.47 6.03 1.52.25.13.34.43.21.67-.09.18-.26.28-.44.28zM3.5 9.72c-.1 0-.2-.03-.29-.09-.23-.16-.28-.47-.12-.7.99-1.4 2.25-2.5 3.75-3.27C9.98 4.04 14 4.03 17.15 5.65c1.5.77 2.76 1.86 3.75 3.27.16.22.11.54-.12.7-.23.16-.54.11-.7-.12-.9-1.29-2.04-2.25-3.39-2.94-2.87-1.47-6.54-1.47-9.4.01-1.36.7-2.5 1.65-3.4 2.94-.08.14-.23.21-.39.21z"/><path d="M9.75 21.79c-.13 0-.26-.05-.35-.15-.87-.87-1.34-1.43-2.01-2.64-.69-1.24-1.16-2.45-1.38-3.50-.25-1.19-.28-2.46-.02-3.64.24-1.07.7-2.04 1.33-2.79.59-.70 1.42-1.29 2.39-1.70.03-.01.06-.02.09-.02.79-.22 1.63-.33 2.49-.33s1.70.11 2.49.33c.03 0 .06.01.09.02.97.41 1.80 1.00 2.39 1.70.63.75 1.09 1.72 1.33 2.79.26 1.18.23 2.45-.02 3.64-.22 1.05-.69 2.26-1.38 3.50-.67 1.21-1.14 1.77-2.01 2.64-.18.18-.47.18-.65 0-.87-.87-1.34-1.43-2.01-2.64-.69-1.24-1.16-2.45-1.38-3.50-.25-1.19-.28-2.46-.02-3.64.24-1.07.7-2.04 1.33-2.79.59-.70 1.42-1.29 2.39-1.70.03-.01.06-.02.09-.02.79-.22 1.63-.33 2.49-.33s1.70.11 2.49.33c.03 0 .06.01.09.02.97.41 1.80 1.00 2.39 1.70.63.75 1.09 1.72 1.33 2.79.26 1.18.23 2.45-.02 3.64-.22 1.05-.69 2.26-1.38 3.50-.67 1.21-1.14 1.77-2.01 2.64-.09.1-.22.15-.35.15s-.26-.05-.35-.15c-.87-.87-1.34-1.43-2.01-2.64-.69-1.24-1.16-2.45-1.38-3.50-.25-1.19-.28-2.46-.02-3.64.24-1.07.7-2.04 1.33-2.79.59-.70 1.42-1.29 2.39-1.70.03-.01.06-.02.09-.02.79-.22 1.63-.33 2.49-.33s1.70.11 2.49.33c.03 0 .06.01.09.02.97.41 1.80 1.00 2.39 1.70.63.75 1.09 1.72 1.33 2.79.26 1.18.23 2.45-.02 3.64-.22 1.05-.69 2.26-1.38 3.50-.67 1.21-1.14 1.77-2.01 2.64-.18.18-.47.18-.65 0z"/></svg>
                    </button>
                    <button id="btnSettings" class="p-2 rounded-full bg-[rgb(var(--card))] hover:opacity-90 animate-press ripple" title="Settings" onclick="toggleSettings(true)">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94a1.5 1.5 0 000-1.88l1.38-1.07-1.5-2.6-1.7.35a5.53 5.53 0 00-1.6-.93l-.35-1.7h-3l-.35 1.7a5.53 5.53 0 00-1.6.93l-1.7-.35-1.5 2.6 1.38 1.07a1.5 1.5 0 000 1.88L4.27 14l1.5 2.6 1.7-.35c.47.4 1.02.72 1.6.93l.35 1.7h3l.35-1.7c.58-.21 1.13-.53 1.6-.93l1.7.35 1.5-2.6-1.38-1.06zM12 14.5A2.5 2.5 0 1114.5 12 2.5 2.5 0 0112 14.5z"/></svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Real-time Alert System -->
        <div id="alertContainer" class="absolute top-20 left-4 right-4 z-50 space-y-2"></div>

        <!-- Main content -->
        <main id="screen" class="hidden px-5 pb-20 space-y-4 overflow-y-auto h-[calc(100%-120px)]"></main>

        <!-- Toast -->
        <div id="toast" class="hidden absolute left-1/2 -translate-x-1/2 bottom-28 px-4 py-2 rounded-full text-white bg-[rgb(var(--accent-2))] elevate">Message sent!</div>

        <!-- Overlay -->
        <div id="overlay" class="hidden absolute inset-0 bg-black/30 z-30" onclick="closeSettings()"></div>

        <!-- Biometric Login Screen -->
        <div id="biometricScreen" class="absolute inset-0 bg-gradient-to-br from-[rgb(var(--bg-1))] to-[rgb(var(--bg-2))] z-60 flex items-center justify-center p-6">
            <div class="w-full max-w-sm space-y-6 text-center">
                <!-- Logo -->
                <div class="flex items-center justify-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-xl bg-[rgb(var(--accent-2))] text-white grid place-items-center font-bold text-base shadow-md">
                        UL
                    </div>
                    <div class="text-left">
                        <div class="text-lg font-bold text-gray-800">UniSync</div>
                        <div class="text-xs text-gray-600">Lecturer Portal</div>
                    </div>
                </div>

                <!-- Biometric Scanner -->
                <div class="relative">
                    <div id="fingerprintButton" class="w-32 h-32 mx-auto rounded-full bg-white shadow-xl flex items-center justify-center cursor-pointer pulse-ring biometric-scan border-2 border-[rgb(var(--accent))/30]" onclick="startBiometricScan()">
                        <svg class="w-16 h-16 text-[rgb(var(--accent-2))]" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 3 12.01 3c-1.98 0-3.86.47-5.57 1.41-.24.13-.54.04-.68-.2-.13-.24-.04-.55.2-.68C7.82 2.52 9.86 2 12.01 2c2.13 0 3.99.47 6.03 1.52.25.13.34.43.21.67-.09.18-.26.28-.44.28zM3.5 9.72c-.1 0-.2-.03-.29-.09-.23-.16-.28-.47-.12-.7.99-1.4 2.25-2.5 3.75-3.27C9.98 4.04 14 4.03 17.15 5.65c1.5.77 2.76 1.86 3.75 3.27.16.22.11.54-.12.7-.23.16-.54.11-.7-.12-.9-1.29-2.04-2.25-3.39-2.94-2.87-1.47-6.54-1.47-9.4.01-1.36.7-2.5 1.65-3.4 2.94-.08.14-.23.21-.39.21z"/>
                            <path d="M9.75 21.79c-.13 0-.26-.05-.35-.15-.87-.87-1.34-1.43-2.01-2.64-.69-1.24-1.16-2.45-1.38-3.50-.25-1.19-.28-2.46-.02-3.64.24-1.07.7-2.04 1.33-2.79.59-.70 1.42-1.29 2.39-1.70.03-.01.06-.02.09-.02.79-.22 1.63-.33 2.49-.33s1.70.11 2.49.33c.03 0 .06.01.09.02.97.41 1.80 1.00 2.39 1.70.63.75 1.09 1.72 1.33 2.79.26 1.18.23 2.45-.02 3.64-.22 1.05-.69 2.26-1.38 3.50-.67 1.21-1.14 1.77-2.01 2.64-.18.18-.47.18-.65 0z"/>
                        </svg>
                    </div>

                    <!-- Success Animation -->
                    <div id="successAnimation" class="hidden absolute inset-0 w-32 h-32 mx-auto rounded-full bg-green-500 flex items-center justify-center shadow-xl border-2 border-green-200">
                        <svg class="w-16 h-16 text-white" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="space-y-1">
                    <h2 id="biometricTitle" class="text-2xl font-bold text-gray-800">Biometric Login</h2>
                    <p id="biometricSubtitle" class="text-gray-600">Touch the sensor to authenticate</p>
                </div>

                <!-- Status -->
                <div id="biometricStatus" class="text-sm text-gray-500 bg-white/40 backdrop-blur-sm rounded-full px-4 py-2 mx-auto inline-block">
                    Place your finger on the sensor
                </div>

                <!-- Alternative Login -->
                <button id="altLoginBtn" onclick="showPasswordLogin()" class="text-[rgb(var(--accent-2))] text-sm underline font-medium hover:opacity-80 transition-colors">
                    Use password instead
                </button>

                <!-- Password Login (Hidden) -->
                <div id="passwordLogin" class="hidden space-y-4">
                    <div class="space-y-3">
                        <input type="email" value="lecturer@unisync.ac.za" class="w-full p-3 rounded-xl border border-[rgb(var(--accent))/30] text-center bg-white shadow-sm text-gray-700 text-sm" readonly>
                        <div class="relative">
                            <input type="password" id="loginPassword" placeholder="Enter your password" class="w-full p-3 pr-10 rounded-xl border border-[rgb(var(--accent))/30] text-center bg-white shadow-sm text-sm">
                            <button type="button" onclick="togglePassword()" class="absolute right-3 top-3 p-1 text-gray-400 hover:text-gray-600">
                                <svg id="eyeIcon" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button onclick="passwordLogin()" class="w-full p-3 rounded-xl bg-[rgb(var(--accent-2))] text-white font-semibold animate-press ripple shadow-md hover:opacity-90 transition-colors">
                        Login
                    </button>
                    <button onclick="showBiometricLogin()" class="text-[rgb(var(--accent-2))] text-sm underline font-medium hover:opacity-80 transition-colors">
                        Back to biometric
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Sheet -->
        <aside id="settingsSheet" class="hidden absolute inset-x-0 bottom-0 max-h-[70%] rounded-t-3xl bg-[rgb(var(--surface))] elevate overflow-hidden z-40">
            <div class="px-4 py-3 border-b border-black/10 flex items-center justify-between">
                <h3 class="font-semibold">Lecturer Settings</h3>
                <button class="p-2 rounded-full hover:bg-black/5 animate-press ripple" onclick="closeSettings()">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/></svg>
                </button>
            </div>
            <div class="p-4 space-y-3 text-sm overflow-y-auto">
                <div class="rounded-2xl bg-white p-3 flex items-center justify-between">
                    <div>
                        <div class="font-medium">Biometric Login</div>
                        <div class="text-xs text-black/60">Enable fingerprint and face recognition login</div>
                    </div>
                    <input type="checkbox" id="biometricToggle" checked onchange="toggleBiometric(this.checked)" class="w-4 h-4">
                </div>
                <div class="rounded-2xl bg-white p-3 flex items-center justify-between">
                    <div>
                        <div class="font-medium">Real-time Alerts</div>
                        <div class="text-xs text-black/60">Get notified of attendance changes</div>
                    </div>
                    <input type="checkbox" id="alertsToggle" checked onchange="toggleAlerts(this.checked)" class="w-4 h-4">
                </div>
                <div class="rounded-2xl bg-white p-3 flex items-center justify-between">
                    <div>
                        <div class="font-medium">Language</div>
                        <div class="text-xs text-black/60">Switch the app language</div>
                    </div>
                    <select class="rounded-xl border border-black/10 px-2 py-1" onchange="setLanguage(this.value)">
                        <option>English</option>
                        <option>isiZulu</option>
                    </select>
                </div>
                <div class="rounded-2xl bg-white p-3">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="font-medium">Theme</div>
                            <div class="text-xs text-black/60">Choose your look</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="px-3 py-1.5 rounded-lg bg-black/10 text-xs animate-press ripple" onclick="applyTheme('lilac')">Light</button>
                            <button class="px-3 py-1.5 rounded-lg bg-black/10 text-xs animate-press ripple" onclick="applyTheme('ink')">Dark</button>
                            <button class="px-3 py-1.5 rounded-lg bg-black/10 text-xs animate-press ripple" onclick="applyTheme('mint')">Mint</button>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Student Query Modal -->
        <div id="queryModal" class="hidden absolute inset-0 bg-black/30 z-50">
            <div class="absolute inset-x-0 bottom-0 max-h-[80%] rounded-t-3xl bg-[rgb(var(--surface))] elevate overflow-hidden">
                <div class="px-4 py-3 border-b border-black/10 flex items-center justify-between">
                    <h3 class="font-semibold">Student Query</h3>
                    <button class="p-2 rounded-full hover:bg-black/5 animate-press ripple" onclick="closeQueryModal()">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/></svg>
                    </button>
                </div>
                <div class="p-4 space-y-4 overflow-y-auto max-h-[calc(80vh-60px)]">
                    <div id="queryStudentInfo" class="rounded-2xl bg-[rgb(var(--card))] p-3">
                        <!-- Student info will be populated here -->
                    </div>
                    <div>
                        <label class="block font-medium mb-2">Your Message:</label>
                        <textarea id="queryText" class="w-full p-3 rounded-xl border border-black/10 resize-none" rows="4" placeholder="Enter your query or message for the student..."></textarea>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="sendQuery()" class="flex-1 py-3 px-4 rounded-xl bg-[rgb(var(--accent-2))] text-white font-medium animate-press ripple">
                            Send Query
                        </button>
                        <button onclick="closeQueryModal()" class="px-6 py-3 rounded-xl bg-[rgb(var(--card))] font-medium animate-press ripple">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // State
    const state = {
      view: 'dashboard',
      selectedStudent: null,
      alertsEnabled: true,
      biometricEnabled: true,
      lastUpdate: Date.now(),
      students: [
        {
          id: 'S001',
          name: 'Alice Johnson',
          email: 'alice.johnson@student.ac.za',
          course: 'Computer Science',
          year: '3rd Year',
          attendance: {
            status: 'present',
            checkedInAt: '09:15 AM',
            qrCodeUsed: 'QR-CS301-240115',
            venue: 'Engineering Building - Room 201'
          }
        },
        {
          id: 'S002',
          name: 'Bob Smith',
          email: 'bob.smith@student.ac.za',
          course: 'Information Systems',
          year: '2nd Year',
          attendance: {
            status: 'present',
            checkedInAt: '09:12 AM',
            qrCodeUsed: 'QR-IS201-240115',
            venue: 'Business Building - Room 105'
          }
        },
        {
          id: 'S003',
          name: 'Carol Davis',
          email: 'carol.davis@student.ac.za',
          course: 'Computer Science',
          year: '1st Year',
          attendance: {
            status: 'present',
            checkedInAt: '09:08 AM',
            qrCodeUsed: 'QR-CS101-240115',
            venue: 'Science Complex - Lab 3'
          }
        },
        {
          id: 'S004',
          name: 'David Wilson',
          email: 'david.wilson@student.ac.za',
          course: 'Information Systems',
          year: '3rd Year',
          attendance: {
            status: 'absent',
            checkedInAt: null,
            qrCodeUsed: null,
            venue: null
          }
        },
        {
          id: 'S005',
          name: 'Emma Thompson',
          email: 'emma.thompson@student.ac.za',
          course: 'Computer Science',
          year: '2nd Year',
          attendance: {
            status: 'present',
            checkedInAt: '09:20 AM',
            qrCodeUsed: 'QR-CS201-240115',
            venue: 'Engineering Building - Room 203'
          }
        }
      ]
    };

    const screen = document.getElementById('screen');
    const headerTitle = document.getElementById('headerTitle');
    const backBtn = document.getElementById('backBtn');

    // Biometric Login Functions
    function showBiometricAuth() {
      if (!state.biometricEnabled) {
        showToast('Biometric login is disabled');
        return;
      }
      // Biometric screen is shown by default on app start
    }

    function startBiometricScan() {
      if (!state.biometricEnabled) {
        showToast('Biometric login is disabled');
        return;
      }

      // Vibrate device if supported
      if (navigator.vibrate) {
        navigator.vibrate(200);
      }

      const fingerprintBtn = document.getElementById('fingerprintButton');
      const successAnim = document.getElementById('successAnimation');
      const status = document.getElementById('biometricStatus');
      const title = document.getElementById('biometricTitle');
      const subtitle = document.getElementById('biometricSubtitle');

      // Start scanning animation
      fingerprintBtn.style.transform = 'scale(0.95)';
      fingerprintBtn.style.opacity = '0.8';
      status.textContent = 'Scanning fingerprint...';
      status.className = 'text-sm text-[rgb(var(--accent-2))]';

      setTimeout(() => {
        // Show success
        fingerprintBtn.classList.add('hidden');
        successAnim.classList.remove('hidden');

        // Vibrate again for success
        if (navigator.vibrate) {
          navigator.vibrate([100, 50, 100]);
        }

        title.textContent = 'Biometric Successful';
        subtitle.textContent = 'Authentication verified';
        status.textContent = 'Welcome back, Dr. Smith';
        status.className = 'text-sm text-[rgb(var(--success))] font-medium';

        setTimeout(() => {
          // Hide biometric screen and show main app
          document.getElementById('biometricScreen').classList.add('hidden');
          document.getElementById('appHeader').classList.remove('hidden');
          document.getElementById('screen').classList.remove('hidden');
          showAlert('Biometric login successful', 'success');
        }, 2000);
      }, 2000);
    }

    function showPasswordLogin() {
      document.getElementById('fingerprintButton').parentElement.classList.add('hidden');
      document.getElementById('biometricTitle').textContent = 'Password Login';
      document.getElementById('biometricSubtitle').textContent = 'Enter your credentials';
      document.getElementById('biometricStatus').classList.add('hidden');
      document.getElementById('altLoginBtn').classList.add('hidden');
      document.getElementById('passwordLogin').classList.remove('hidden');
    }

    function showBiometricLogin() {
      document.getElementById('fingerprintButton').parentElement.classList.remove('hidden');
      document.getElementById('biometricTitle').textContent = 'Biometric Login';
      document.getElementById('biometricSubtitle').textContent = 'Touch the sensor to authenticate';
      document.getElementById('biometricStatus').classList.remove('hidden');
      document.getElementById('altLoginBtn').classList.remove('hidden');
      document.getElementById('passwordLogin').classList.add('hidden');
    }

    function passwordLogin() {
      const password = document.getElementById('loginPassword').value;
      if (!password) {
        showToast('Please enter your password');
        return;
      }

      const status = document.getElementById('biometricStatus');
      status.classList.remove('hidden');
      status.textContent = 'Verifying credentials...';
      status.className = 'text-sm text-[rgb(var(--accent-2))]';

      setTimeout(() => {
        status.textContent = 'Login successful!';
        status.className = 'text-sm text-[rgb(var(--success))] font-medium';

        setTimeout(() => {
          document.getElementById('biometricScreen').classList.add('hidden');
          document.getElementById('appHeader').classList.remove('hidden');
          document.getElementById('screen').classList.remove('hidden');
          showAlert('Password login successful', 'success');
        }, 1500);
      }, 1500);
    }

    function togglePassword() {
      const passwordInput = document.getElementById('loginPassword');
      const eyeIcon = document.getElementById('eyeIcon');

      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeIcon.innerHTML = '<path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>';
      } else {
        passwordInput.type = 'password';
        eyeIcon.innerHTML = '<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';
      }
    }

    function toggleBiometric(enabled) {
      state.biometricEnabled = enabled;
      localStorage.setItem('biometricEnabled', enabled);
      showToast(enabled ? 'Biometric login enabled' : 'Biometric login disabled');
    }

    // Real-time Alert System
    function showAlert(message, type = 'info', duration = 5000) {
      if (!state.alertsEnabled) return;

      const alertContainer = document.getElementById('alertContainer');
      const alertId = 'alert-' + Date.now();

      const typeStyles = {
        info: 'bg-[rgb(var(--accent-2))] text-white',
        success: 'bg-[rgb(var(--success))] text-white',
        warning: 'bg-[rgb(var(--warn))] text-white',
        danger: 'bg-[rgb(var(--danger))] text-white'
      };

      const alertElement = document.createElement('div');
      alertElement.id = alertId;
      alertElement.className = `p-3 rounded-xl ${typeStyles[type]} elevate alert-enter flex items-center justify-between text-sm`;
      alertElement.innerHTML = `
        <div class="flex items-center gap-2">
          <div class="w-2 h-2 bg-white rounded-full live-indicator"></div>
          <span>${message}</span>
        </div>
        <button onclick="dismissAlert('${alertId}')" class="p-1 rounded-full hover:bg-white/20">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/>
          </svg>
        </button>
      `;

      alertContainer.appendChild(alertElement);

      // Auto dismiss
      setTimeout(() => {
        dismissAlert(alertId);
      }, duration);
    }

    function dismissAlert(alertId) {
      const alert = document.getElementById(alertId);
      if (alert) {
        alert.classList.remove('alert-enter');
        alert.classList.add('alert-exit');
        setTimeout(() => {
          alert.remove();
        }, 300);
      }
    }

    function toggleAlerts(enabled) {
      state.alertsEnabled = enabled;
      localStorage.setItem('alertsEnabled', enabled);
      showToast(enabled ? 'Alerts enabled' : 'Alerts disabled');
    }

    // Simulate real-time attendance changes
    function simulateRealTimeUpdates() {
      setInterval(() => {
        // Randomly change a student's status to simulate real-time updates
        if (Math.random() < 0.1) { // 10% chance every 10 seconds
          const randomStudent = state.students[Math.floor(Math.random() * state.students.length)];
          const oldStatus = randomStudent.attendance.status;

          // Simulate QR code check-ins
          if (oldStatus === 'absent' && Math.random() < 0.7) {
            randomStudent.attendance.status = 'present';
            randomStudent.attendance.checkedInAt = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            randomStudent.attendance.qrCodeUsed = `QR-${randomStudent.course.split(' ')[0]}${randomStudent.year.charAt(0)}01-240115`;
            randomStudent.attendance.venue = 'Engineering Building - Room 201';

            showAlert(`${randomStudent.name} scanned QR code`, 'success');
          }

          // Update dashboard if currently viewing it
          if (state.view === 'dashboard') {
            render();
          }
        }
      }, 10000); // Check every 10 seconds
    }

    // Helpers
    const showToast = (msg = 'Message sent!') => {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.remove('hidden');
      setTimeout(() => t.classList.add('hidden'), 2000);
    };

    const chip = (text, tone = 'accent') => {
      const tones = {
        accent: 'bg-[rgb(var(--accent))/15] text-[rgb(var(--accent-2))]',
        good: 'bg-[rgb(var(--success))/18] text-[rgb(var(--success))]',
        warn: 'bg-[rgb(var(--warn))/18] text-[rgb(var(--warn))]',
        danger: 'bg-[rgb(var(--danger))/18] text-[rgb(var(--danger))]',
        mute: 'bg-black/10 text-black/70'
      };
      return `<span class="px-2.5 py-1 rounded-full text-xs font-medium ${tones[tone] || tones.accent}">${text}</span>`;
    };

    const getAttendanceStatus = (student) => {
      if (student.attendance.status === 'absent') {
        return chip('Absent', 'danger');
      } else {
        return chip('Present – QR Verified', 'good');
      }
    };

    // Generate simple chart data
    function generateAttendanceChart() {
      const presentCount = state.students.filter(s => s.attendance.status === 'present').length;
      const absentCount = state.students.filter(s => s.attendance.status === 'absent').length;
      const total = state.students.length;

      const presentPercentage = Math.round((presentCount / total) * 100);
      const absentPercentage = Math.round((absentCount / total) * 100);

      return `
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <span class="text-sm">Present</span>
            <span class="font-medium">${presentCount}/${total} (${presentPercentage}%)</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-[rgb(var(--success))] h-2 rounded-full" style="width: ${presentPercentage}%"></div>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm">Absent</span>
            <span class="font-medium">${absentCount}/${total} (${absentPercentage}%)</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-[rgb(var(--danger))] h-2 rounded-full" style="width: ${absentPercentage}%"></div>
          </div>
        </div>
      `;
    }

    // Screens
    function dashboardScreen() {
      headerTitle.textContent = 'UniSync Lecturer';
      backBtn.classList.add('hidden');

      const presentCount = state.students.filter(s => s.attendance.status === 'present').length;
      const absentCount = state.students.filter(s => s.attendance.status === 'absent').length;
      const qrVerifiedCount = state.students.filter(s => s.attendance.status === 'present' && s.attendance.qrCodeUsed).length;
      const totalStudents = state.students.length;
      const attendanceRate = Math.round((presentCount / totalStudents) * 100);

      return `
        <div class="space-y-4">


          <!-- Stats Overview -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <div class="flex items-center justify-between mb-3">
              <h2 class="font-semibold text-lg">Today's Overview</h2>
              <span class="text-xs text-black/50">Last updated: ${new Date().toLocaleTimeString()}</span>
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div class="text-center p-3 rounded-2xl bg-[rgb(var(--success))/10]">
                <div class="text-2xl font-bold text-[rgb(var(--success))]">${presentCount}</div>
                <div class="text-xs text-black/60">Present</div>
              </div>
              <div class="text-center p-3 rounded-2xl bg-[rgb(var(--danger))/10]">
                <div class="text-2xl font-bold text-[rgb(var(--danger))]">${absentCount}</div>
                <div class="text-xs text-black/60">Absent</div>
              </div>
              <div class="text-center p-3 rounded-2xl bg-[rgb(var(--accent-2))/10]">
                <div class="text-2xl font-bold text-[rgb(var(--accent-2))]">${qrVerifiedCount}</div>
                <div class="text-xs text-black/60">QR Verified</div>
              </div>
              <div class="text-center p-3 rounded-2xl bg-[rgb(var(--warn))/10]">
                <div class="text-2xl font-bold text-[rgb(var(--warn))]">${totalStudents - presentCount}</div>
                <div class="text-xs text-black/60">Not Checked In</div>
              </div>
            </div>
          </div>

          <!-- Attendance Chart -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Participation Summary</h3>
            ${generateAttendanceChart()}
          </div>

          <!-- Quick Actions -->
          <div class="rounded-3xl bg-[rgb(var(--card))] p-4 elevate">
            <h3 class="font-semibold mb-3">Quick Actions</h3>
            <div class="space-y-2">
              <button class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple" onclick="showStudents()">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">View All Students</div>
                    <div class="text-xs text-black/60">Manage attendance and send queries</div>
                  </div>
                  <svg class="w-5 h-5 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                  </svg>
                </div>
              </button>
              <button class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple" onclick="showQRGenerator()">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Generate QR Code</div>
                    <div class="text-xs text-black/60">Create QR code for class attendance</div>
                  </div>
                  <svg class="w-5 h-5 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H9V11M15,11H17V13H15V11M19,5H21V9H19V5M5,5H9V9H5V5M3,19H5V21H3V19M5,19H9V21H5V19M11,19H13V21H11V19M15,19H21V21H15V19M19,11H21V15H19V11M19,15H21V19H19V15Z"/>
                  </svg>
                </div>
              </button>
              <button class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple" onclick="showAttendanceHistory()">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Attendance History</div>
                    <div class="text-xs text-black/60">View QR code attendance records</div>
                  </div>
                  <svg class="w-5 h-5 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                  </svg>
                </div>
              </button>
              <button class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple" onclick="showReports()">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">View Reports</div>
                    <div class="text-xs text-black/60">Generate attendance reports</div>
                  </div>
                  <svg class="w-5 h-5 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                  </svg>
                </div>
              </button>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Recent Activity</h3>
              <div class="flex items-center gap-1">
                <div class="w-2 h-2 bg-[rgb(var(--success))] rounded-full live-indicator"></div>
                <span class="text-xs text-black/50">Live</span>
              </div>
            </div>
            <div class="space-y-3">
              ${state.students.filter(s => s.attendance.status === 'present').slice(0, 3).map(student => `
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-[rgb(var(--accent))] to-[rgb(var(--accent-2))] text-white text-xs font-medium grid place-items-center">
                      ${student.name.split(' ').map(n => n[0]).join('')}
                    </div>
                    <div>
                      <div class="font-medium text-sm">${student.name}</div>
                      <div class="text-xs text-black/60">Checked In</div>
                    </div>
                  </div>
                  <div class="w-2 h-2 rounded-full bg-[rgb(var(--success))]"></div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function studentsScreen() {
      headerTitle.textContent = 'All Students';
      backBtn.classList.remove('hidden');

      return `
        <div class="space-y-4">
          <!-- Search Bar -->
          <div class="rounded-2xl bg-white p-3 elevate">
            <div class="relative">
              <input type="text" placeholder="Search students..." class="w-full pl-10 pr-4 py-2 rounded-xl border border-black/10 text-sm">
              <svg class="absolute left-3 top-2.5 w-4 h-4 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
            </div>
          </div>

          <!-- Students List -->
          <div class="space-y-3">
            ${state.students.map(student => `
              <div class="rounded-2xl bg-white p-4 elevate">
                <div class="flex items-start justify-between">
                  <div class="flex items-start gap-3 flex-1">
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-[rgb(var(--accent))] to-[rgb(var(--accent-2))] text-white font-medium grid place-items-center relative">
                      ${student.name.split(' ').map(n => n[0]).join('')}
                      ${student.attendance.status === 'present' ? '<div class="absolute -top-1 -right-1 w-3 h-3 bg-[rgb(var(--success))] rounded-full live-indicator"></div>' : ''}
                    </div>
                    <div class="flex-1">
                      <div class="font-semibold">${student.name}</div>
                      <div class="text-sm text-black/60">${student.course} • ${student.year}</div>
                      <div class="text-xs text-black/50 mt-1">${student.email}</div>
                      <div class="mt-2">
                        ${getAttendanceStatus(student)}
                      </div>
                      ${student.attendance.status === 'present' ? `
                        <div class="text-xs text-black/50 mt-1">
                          QR verified attendance
                        </div>
                      ` : `
                        <div class="text-xs text-black/50 mt-1">
                          Not checked in today
                        </div>
                      `}
                    </div>
                  </div>
                  <button onclick="openQueryModal('${student.id}')" class="p-2 rounded-xl bg-[rgb(var(--accent))/15] text-[rgb(var(--accent-2))] hover:opacity-80 animate-press ripple" title="Send Query">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
                    </svg>
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function qrGeneratorScreen() {
      headerTitle.textContent = 'QR Code Generator';
      backBtn.classList.remove('hidden');

      const currentDate = new Date().toLocaleDateString();
      const currentTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

      return `
        <div class="space-y-4">
          <!-- QR Code Display -->
          <div class="rounded-3xl bg-white p-6 elevate text-center">
            <h3 class="font-semibold mb-4">Today's Class QR Code</h3>

            <!-- Simple QR Code representation -->
            <div class="w-48 h-48 mx-auto mb-4 bg-white border-2 border-black/10 rounded-2xl flex items-center justify-center">
              <div class="grid grid-cols-8 gap-1 p-4">
                ${Array.from({length: 64}, (_, i) => {
                  const isBlack = Math.random() > 0.5;
                  return `<div class="w-2 h-2 ${isBlack ? 'bg-black' : 'bg-white'} rounded-sm"></div>`;
                }).join('')}
              </div>
            </div>

            <div class="space-y-2">
              <div class="font-medium">QR-CS301-${new Date().toISOString().slice(0,10).replace(/-/g,'')}</div>
              <div class="text-sm text-black/60">Valid for: ${currentDate} • ${currentTime}</div>
              <div class="text-xs text-black/50">Engineering Building - Room 201</div>
            </div>
          </div>

          <!-- QR Code Settings -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-4">QR Code Settings</h3>
            <div class="space-y-3">
              <div>
                <label class="block font-medium mb-2">Class/Course</label>
                <select class="w-full p-3 rounded-xl border border-black/10">
                  <option>Computer Science 301</option>
                  <option>Information Systems 201</option>
                  <option>Computer Science 101</option>
                </select>
              </div>
              <div>
                <label class="block font-medium mb-2">Venue</label>
                <select class="w-full p-3 rounded-xl border border-black/10">
                  <option>Engineering Building - Room 201</option>
                  <option>Science Complex - Lab 3</option>
                  <option>Business Building - Room 105</option>
                </select>
              </div>
              <div>
                <label class="block font-medium mb-2">Valid Duration</label>
                <select class="w-full p-3 rounded-xl border border-black/10">
                  <option>15 minutes</option>
                  <option>30 minutes</option>
                  <option>1 hour</option>
                  <option>2 hours</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="space-y-3">
            <button onclick="generateNewQR()" class="w-full p-4 rounded-2xl bg-[rgb(var(--accent-2))] text-white font-medium animate-press ripple">
              Generate New QR Code
            </button>
            <button onclick="downloadQR()" class="w-full p-4 rounded-2xl bg-[rgb(var(--card))] font-medium animate-press ripple">
              Download QR Code
            </button>
          </div>

          <!-- Active QR Codes -->
          <div class="rounded-3xl bg-[rgb(var(--card))] p-4 elevate">
            <h3 class="font-semibold mb-3">Active QR Codes</h3>
            <div class="space-y-2">
              <div class="p-3 rounded-2xl bg-white">
                <div class="flex justify-between items-center">
                  <div>
                    <div class="font-medium text-sm">QR-CS301-240115</div>
                    <div class="text-xs text-black/60">Engineering Building - Room 201</div>
                  </div>
                  <div class="text-right">
                    <div class="text-xs text-[rgb(var(--success))]">Active</div>
                    <div class="text-xs text-black/50">12 min left</div>
                  </div>
                </div>
              </div>
              <div class="p-3 rounded-2xl bg-white">
                <div class="flex justify-between items-center">
                  <div>
                    <div class="font-medium text-sm">QR-IS201-240115</div>
                    <div class="text-xs text-black/60">Business Building - Room 105</div>
                  </div>
                  <div class="text-right">
                    <div class="text-xs text-[rgb(var(--warn))]">Expiring</div>
                    <div class="text-xs text-black/50">3 min left</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function attendanceHistoryScreen() {
      headerTitle.textContent = 'Attendance History';
      backBtn.classList.remove('hidden');

      return `
        <div class="space-y-4">
          <!-- Info Banner -->
          <div class="rounded-2xl bg-gradient-to-r from-[rgb(var(--accent))] to-[rgb(var(--accent-2))] p-4 text-white">
            <div class="flex items-center gap-3">
              <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H9V11M15,11H17V13H15V11M19,5H21V9H19V5M5,5H9V9H5V5M3,19H5V21H3V19M5,19H9V21H5V19M11,19H13V21H11V19M15,19H21V21H15V19M19,11H21V15H19V11M19,15H21V19H19V15Z"/>
              </svg>
              <div>
                <div class="font-semibold">QR Code Attendance System</div>
                <div class="text-sm opacity-90">Students check in by scanning QR codes in classrooms</div>
              </div>
            </div>
          </div>

          <!-- Date Selector -->
          <div class="rounded-2xl bg-white p-4 elevate">
            <label class="block font-medium mb-2">View Date</label>
            <input type="date" value="${new Date().toISOString().split('T')[0]}" class="w-full p-3 rounded-xl border border-black/10">
          </div>

          <!-- Attendance History -->
          <div class="space-y-3">
            ${state.students.map(student => `
              <div class="rounded-2xl bg-white p-4 elevate">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-2xl bg-gradient-to-br from-[rgb(var(--accent))] to-[rgb(var(--accent-2))] text-white text-sm font-medium grid place-items-center relative">
                      ${student.name.split(' ').map(n => n[0]).join('')}
                      ${student.attendance.status === 'present' ? '<div class="absolute -top-1 -right-1 w-3 h-3 bg-[rgb(var(--success))] rounded-full live-indicator"></div>' : ''}
                    </div>
                    <div>
                      <div class="font-medium">${student.name}</div>
                      <div class="text-sm text-black/60">${student.course}</div>
                      ${student.attendance.status === 'present' ? `
                        <div class="text-xs text-black/50 mt-1">
                          QR Check-in: ${student.attendance.checkedInAt}
                        </div>
                      ` : `
                        <div class="text-xs text-black/50 mt-1">
                          No QR check-in today
                        </div>
                      `}
                    </div>
                  </div>
                  <div class="text-right">
                    ${getAttendanceStatus(student)}
                    ${student.attendance.status === 'present' ? `
                      <div class="text-xs text-black/50 mt-1">
                        QR verified attendance
                      </div>
                    ` : ''}
                  </div>
                </div>
              </div>
            `).join('')}
          </div>

          <!-- Override Section -->
          <div class="rounded-2xl bg-[rgb(var(--card))] p-4 elevate">
            <h3 class="font-semibold mb-2">Manual Override</h3>
            <p class="text-sm text-black/60 mb-3">Only use if automatic tracking fails or needs correction</p>
            <button onclick="showManualOverride()" class="w-full p-3 rounded-xl bg-white text-[rgb(var(--accent-2))] font-medium animate-press ripple">
              Override Attendance Records
            </button>
          </div>
        </div>
      `;
    }

    function reportsScreen() {
      headerTitle.textContent = 'Reports';
      backBtn.classList.remove('hidden');

      const totalStudents = state.students.length;
      const presentToday = state.students.filter(s => s.attendance.status === 'present').length;
      const attendanceRate = Math.round((presentToday / totalStudents) * 100);

      return `
        <div class="space-y-4">
          <!-- Summary Stats -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-4">Today's Summary</h3>
            <div class="grid grid-cols-3 gap-4 text-center">
              <div>
                <div class="text-2xl font-bold text-[rgb(var(--accent-2))]">${totalStudents}</div>
                <div class="text-xs text-black/60">Total Students</div>
              </div>
              <div>
                <div class="text-2xl font-bold text-[rgb(var(--success))]">${presentToday}</div>
                <div class="text-xs text-black/60">Present</div>
              </div>
              <div>
                <div class="text-2xl font-bold text-[rgb(var(--accent))]">${attendanceRate}%</div>
                <div class="text-xs text-black/60">Attendance Rate</div>
              </div>
            </div>
          </div>

          <!-- Detailed Chart -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-4">Detailed Breakdown</h3>
            ${generateAttendanceChart()}
          </div>
          <!-- QR Code Analysis -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-4">QR Code Analysis</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-sm">QR Verified</span>
                <span class="font-medium">${state.students.filter(s => s.attendance.qrCodeUsed).length} students</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm">Not Checked In</span>
                <span class="font-medium">${state.students.filter(s => !s.attendance.qrCodeUsed).length} students</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm">Attendance Rate</span>
                <span class="font-medium">${Math.round((state.students.filter(s => s.attendance.qrCodeUsed).length / state.students.length) * 100)}%</span>
              </div>
            </div>
          </div>

          <!-- Export Options -->
          <div class="rounded-3xl bg-[rgb(var(--card))] p-4 elevate">
            <h3 class="font-semibold mb-4">Export Reports</h3>
            <div class="space-y-2">
              <button onclick="exportReport('pdf')" class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Export as PDF</div>
                    <div class="text-xs text-black/60">Download attendance report</div>
                  </div>
                  <svg class="w-5 h-5 text-red-500" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                  </svg>
                </div>
              </button>
              <button onclick="exportReport('excel')" class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Export as Excel</div>
                    <div class="text-xs text-black/60">Download spreadsheet format</div>
                  </div>
                  <svg class="w-5 h-5 text-green-500" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                  </svg>
                </div>
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Actions
    function showStudents() {
      state.view = 'students';
      render();
    }

    function showQRGenerator() {
      state.view = 'qrGenerator';
      render();
    }

    function showAttendanceHistory() {
      state.view = 'attendanceHistory';
      render();
    }

    function generateNewQR() {
      showToast('New QR code generated successfully!');
      showAlert('QR code is now active for attendance', 'success');
    }

    function downloadQR() {
      showToast('QR code downloaded to device');
    }

    function showManualOverride() {
      showToast('Manual override feature available for system administrators');
    }

    function showReports() {
      state.view = 'reports';
      render();
    }

    function goBack() {
      state.view = 'dashboard';
      render();
    }

    function markAttendance(studentId, status) {
      const student = state.students.find(s => s.id === studentId);
      if (student) {
        const oldStatus = student.attendance.status;
        student.attendance.status = status;

        if (status === 'absent') {
          student.attendance.location = null;
          student.attendance.venue = null;
        } else if (status === 'present' && oldStatus === 'absent') {
          student.attendance.location = Math.random() < 0.6 ? 'campus' : 'off-campus';
          student.attendance.lastSeen = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
          student.attendance.venue = student.attendance.location === 'campus' ?
            'Engineering Building - Room 201' : 'Home - Remote';
        }

        // Show real-time alert
        if (oldStatus !== status) {
          const alertType = status === 'present' ? 'success' : 'warning';
          const message = status === 'present' ?
            `${student.name} marked present` :
            `${student.name} marked absent`;
          showAlert(message, alertType);
        }

        render();
      }
    }

    function saveAttendance() {
      showToast('Attendance saved successfully!');
      showAlert('Attendance data synchronized', 'success');
    }

    function exportReport(format) {
      showToast(`Exporting report as ${format.toUpperCase()}...`);
    }

    function openQueryModal(studentId) {
      const student = state.students.find(s => s.id === studentId);
      if (!student) return;

      state.selectedStudent = student;

      document.getElementById('queryStudentInfo').innerHTML = `
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-[rgb(var(--accent))] to-[rgb(var(--accent-2))] text-white font-medium grid place-items-center">
            ${student.name.split(' ').map(n => n[0]).join('')}
          </div>
          <div>
            <div class="font-semibold">${student.name}</div>
            <div class="text-sm text-black/60">${student.course} • ${student.year}</div>
            <div class="text-xs text-black/50">${student.email}</div>
            <div class="mt-2">
              ${getAttendanceStatus(student)}
            </div>
          </div>
        </div>
      `;

      document.getElementById('queryText').value = '';
      document.getElementById('queryModal').classList.remove('hidden');
    }

    function closeQueryModal() {
      document.getElementById('queryModal').classList.add('hidden');
      state.selectedStudent = null;
    }

    function sendQuery() {
      const queryText = document.getElementById('queryText').value.trim();
      if (!queryText || !state.selectedStudent) return;

      showToast(`Query sent to ${state.selectedStudent.name}`);
      showAlert(`Message sent to ${state.selectedStudent.name}`, 'info');
      closeQueryModal();
    }

    // Settings functions
    function toggleSettings(show = true) {
      const overlay = document.getElementById('overlay');
      const sheet = document.getElementById('settingsSheet');

      if (show) {
        overlay.classList.remove('hidden');
        sheet.classList.remove('hidden');
      } else {
        overlay.classList.add('hidden');
        sheet.classList.add('hidden');
      }
    }

    function closeSettings() {
      toggleSettings(false);
    }

    function setLanguage(lang) {
      localStorage.setItem('language', lang);
      showToast('Language updated');
    }

    function applyTheme(theme) {
      const frame = document.getElementById('frame');
      frame.classList.remove('theme-lilac', 'theme-ink', 'theme-mint');

      if (theme === 'ink') {
        frame.classList.add('theme-ink');
        document.documentElement.style.setProperty('--bg-1', '17 24 39');
        document.documentElement.style.setProperty('--bg-2', '31 41 55');
        document.documentElement.style.setProperty('--surface', '24 31 44');
        document.documentElement.style.setProperty('--card', '31 41 55');
        document.documentElement.style.setProperty('--ink', '236 253 245');
        document.documentElement.style.setProperty('--accent', '147 197 253');
        document.documentElement.style.setProperty('--accent-2', '59 130 246');
      } else if (theme === 'mint') {
        frame.classList.add('theme-mint');
        document.documentElement.style.setProperty('--bg-1', '236 253 245');
        document.documentElement.style.setProperty('--bg-2', '209 250 229');
        document.documentElement.style.setProperty('--surface', '255 255 255');
        document.documentElement.style.setProperty('--card', '209 250 229');
        document.documentElement.style.setProperty('--accent', '52 211 153');
        document.documentElement.style.setProperty('--accent-2', '16 185 129');
      } else {
        frame.classList.add('theme-lilac');
        document.documentElement.style.setProperty('--bg-1', '245 243 255');
        document.documentElement.style.setProperty('--bg-2', '237 233 254');
        document.documentElement.style.setProperty('--surface', '255 255 255');
        document.documentElement.style.setProperty('--card', '234 231 251');
        document.documentElement.style.setProperty('--ink', '26 26 31');
        document.documentElement.style.setProperty('--accent', '167 139 250');
        document.documentElement.style.setProperty('--accent-2', '139 92 246');
      }

      localStorage.setItem('theme', theme);
      showToast('Theme updated');
    }

    // Render
    function render() {
      if (state.view === 'dashboard') {
        screen.innerHTML = dashboardScreen();
      } else if (state.view === 'students') {
        screen.innerHTML = studentsScreen();
      } else if (state.view === 'qrGenerator') {
        screen.innerHTML = qrGeneratorScreen();
      } else if (state.view === 'attendanceHistory') {
        screen.innerHTML = attendanceHistoryScreen();
      } else if (state.view === 'reports') {
        screen.innerHTML = reportsScreen();
      }
    }

    // Init
    (function init() {
      const savedTheme = localStorage.getItem('theme') || 'lilac';
      const savedAlertsEnabled = localStorage.getItem('alertsEnabled') !== 'false';
      const savedBiometricEnabled = localStorage.getItem('biometricEnabled') !== 'false';

      applyTheme(savedTheme);
      state.alertsEnabled = savedAlertsEnabled;
      state.biometricEnabled = savedBiometricEnabled;
      document.getElementById('alertsToggle').checked = savedAlertsEnabled;
      document.getElementById('biometricToggle').checked = savedBiometricEnabled;

      // Show biometric screen first
      document.getElementById('biometricScreen').classList.remove('hidden');
      document.getElementById('appHeader').classList.add('hidden');
      document.getElementById('screen').classList.add('hidden');

      state.view = 'dashboard';
      render();

      // Start real-time simulation
      simulateRealTimeUpdates();
    })();
</script>
</body>
</html>
