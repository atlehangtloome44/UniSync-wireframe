<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UniSync — Admin Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root{
          /* Same pastel palette */
          --bg-1:245 243 255;
          --bg-2:237 233 254;
          --surface:255 255 255;
          --card:234 231 251;
          --ink:26 26 31;
          --muted:99 102 106;
          --accent:167 139 250;
          --accent-2:139 92 246;
          --success:16 185 129;
          --warn:245 158 11;
          --danger:239 68 68;
          --ring:167 139 250;
        }
        .glass{backdrop-filter:blur(12px);background:rgba(255,255,255,.5)}
        .elevate{box-shadow:0 8px 24px rgba(0,0,0,.10)}
        .elevate-strong{box-shadow:0 16px 40px rgba(0,0,0,.18)}
        .animate-press{transition:transform .15s ease, opacity .15s ease}
        .ripple:active{transform:scale(0.98); opacity:0.9}
        @keyframes pulse{0%{transform:scale(1);opacity:.6}70%,100%{transform:scale(1.5);opacity:0}}
        .pulse-ring{position:relative}
        .pulse-ring::after{content:'';position:absolute;inset:-20px;border-radius:9999px;background:rgba(99,102,241,.3);animation:pulse 2s ease-out infinite;pointer-events:none}
        @keyframes slideInRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
        @keyframes slideOutRight{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}
        .alert-enter{animation:slideInRight 0.3s ease-out}
        .alert-exit{animation:slideOutRight 0.3s ease-in}
        .live-indicator{animation:pulse 2s infinite}
        @keyframes scanLine{0%{transform:translateY(-100%)}100%{transform:translateY(200px)}}
        .biometric-scan{position:relative;overflow:hidden}
        .biometric-scan::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgb(var(--accent-2)),transparent);animation:scanLine 2s ease-in-out infinite}
        @keyframes countUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .count-up{animation:countUp 0.8s ease-out}
        .chart-bar{transition:height 0.8s ease-out}
        @keyframes gpsSignal{0%{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:0.7}100%{transform:scale(1);opacity:1}}
        .gps-signal{animation:gpsSignal 2s ease-in-out infinite}
    </style>
</head>
<body class="h-full bg-[rgb(var(--bg-1))] bg-gradient-to-br from-[rgb(var(--bg-1))] to-[rgb(var(--bg-2))] text-[rgb(var(--ink))] antialiased" style="font-family: Roboto, system-ui, -apple-system, Segoe UI, Helvetica, Arial;">
<div class="min-h-screen flex items-center justify-center p-4">
    <!-- Android phone frame -->
    <div id="frame" class="w-full max-w-sm h-[820px] md:h-[860px] rounded-[32px] bg-[rgb(var(--surface))] border border-white/40 elevate overflow-hidden relative">
        <!-- Status spacer + camera hole -->
        <div class="relative h-6">
            <div class="absolute left-1/2 -translate-x-1/2 top-1 w-16 h-3 rounded-full bg-black/10"></div>
        </div>

        <!-- Top App Bar -->
        <header id="appHeader" class="hidden px-5 pt-2 pb-3 sticky top-0 z-30 bg-[rgb(var(--surface))]/90 glass">
            <div class="flex items-center justify-between">
                <button id="backBtn" class="p-2 rounded-full bg-[rgb(var(--card))] hover:opacity-90 animate-press ripple hidden" onclick="goBack()">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-2xl bg-gradient-to-br from-red-500 to-red-600 text-white grid place-items-center font-semibold relative">
                        UA
                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-[rgb(var(--success))] rounded-full live-indicator"></div>
                    </div>
                    <div>
                        <div id="headerTitle" class="text-lg font-semibold tracking-tight leading-none">UniSync Admin</div>
                        <div class="text-[11px] text-black/50 flex items-center gap-1">
                            <span class="w-2 h-2 bg-[rgb(var(--success))] rounded-full live-indicator"></span>
                            Live Control Center
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="btnBiometric" class="p-2 rounded-full bg-[rgb(var(--card))] hover:opacity-90 animate-press ripple" title="Biometric Auth" onclick="showBiometricAuth()">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 3 12.01 3c-1.98 0-3.86.47-5.57 1.41-.24.13-.54.04-.68-.2-.13-.24-.04-.55.2-.68C7.82 2.52 9.86 2 12.01 2c2.13 0 3.99.47 6.03 1.52.25.13.34.43.21.67-.09.18-.26.28-.44.28zM3.5 9.72c-.1 0-.2-.03-.29-.09-.23-.16-.28-.47-.12-.7.99-1.4 2.25-2.5 3.75-3.27C9.98 4.04 14 4.03 17.15 5.65c1.5.77 2.76 1.86 3.75 3.27.16.22.11.54-.12.7-.23.16-.54.11-.7-.12-.9-1.29-2.04-2.25-3.39-2.94-2.87-1.47-6.54-1.47-9.4.01-1.36.7-2.5 1.65-3.4 2.94-.08.14-.23.21-.39.21z"/><path d="M9.75 21.79c-.13 0-.26-.05-.35-.15-.87-.87-1.34-1.43-2.01-2.64-.69-1.24-1.16-2.45-1.38-3.50-.25-1.19-.28-2.46-.02-3.64.24-1.07.7-2.04 1.33-2.79.59-.70 1.42-1.29 2.39-1.70.03-.01.06-.02.09-.02.79-.22 1.63-.33 2.49-.33s1.70.11 2.49.33c.03 0 .06.01.09.02.97.41 1.80 1.00 2.39 1.70.63.75 1.09 1.72 1.33 2.79.26 1.18.23 2.45-.02 3.64-.22 1.05-.69 2.26-1.38 3.50-.67 1.21-1.14 1.77-2.01 2.64-.18.18-.47.18-.65 0z"/></svg>
                    </button>
                    <button id="btnSettings" class="p-2 rounded-full bg-[rgb(var(--card))] hover:opacity-90 animate-press ripple" title="Settings" onclick="toggleSettings(true)">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94a1.5 1.5 0 000-1.88l1.38-1.07-1.5-2.6-1.7.35a5.53 5.53 0 00-1.6-.93l-.35-1.7h-3l-.35 1.7a5.53 5.53 0 00-1.6.93l-1.7-.35-1.5 2.6 1.38 1.07a1.5 1.5 0 000 1.88L4.27 14l1.5 2.6 1.7-.35c.47.4 1.02.72 1.6.93l.35 1.7h3l.35-1.7c.58-.21 1.13-.53 1.6-.93l1.7.35 1.5-2.6-1.38-1.06zM12 14.5A2.5 2.5 0 1114.5 12 2.5 2.5 0 0112 14.5z"/></svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Real-time Alert System -->
        <div id="alertContainer" class="absolute top-20 left-4 right-4 z-50 space-y-2"></div>

        <!-- Main content -->
        <main id="screen" class="hidden px-5 pb-20 space-y-4 overflow-y-auto h-[calc(100%-120px)]"></main>

        <!-- Toast -->
        <div id="toast" class="hidden absolute left-1/2 -translate-x-1/2 bottom-28 px-4 py-2 rounded-full text-white bg-[rgb(var(--accent-2))] elevate">Message sent!</div>

        <!-- Overlay -->
        <div id="overlay" class="hidden absolute inset-0 bg-black/30 z-30" onclick="closeSettings()"></div>

        <!-- Biometric Login Screen -->
        <div id="biometricScreen" class="absolute inset-0 bg-gradient-to-br from-[rgb(var(--bg-1))] to-[rgb(var(--bg-2))] z-60 flex items-center justify-center p-6">
            <div class="w-full max-w-sm space-y-6 text-center">
                <!-- Logo -->
                <div class="flex items-center justify-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-red-600 text-white grid place-items-center font-bold text-base shadow-md">
                        UA
                    </div>
                    <div class="text-left">
                        <div class="text-lg font-bold text-gray-800">UniSync</div>
                        <div class="text-xs text-gray-600">Admin Portal</div>
                    </div>
                </div>

                <!-- Biometric Scanner -->
                <div class="relative">
                    <div id="fingerprintButton" class="w-32 h-32 mx-auto rounded-full bg-white shadow-xl flex items-center justify-center cursor-pointer pulse-ring biometric-scan border-2 border-[rgb(var(--accent))/30]" onclick="startBiometricScan()">
                        <svg class="w-16 h-16 text-[rgb(var(--accent-2))]" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 3 12.01 3c-1.98 0-3.86.47-5.57 1.41-.24.13-.54.04-.68-.2-.13-.24-.04-.55.2-.68C7.82 2.52 9.86 2 12.01 2c2.13 0 3.99.47 6.03 1.52.25.13.34.43.21.67-.09.18-.26.28-.44.28zM3.5 9.72c-.1 0-.2-.03-.29-.09-.23-.16-.28-.47-.12-.7.99-1.4 2.25-2.5 3.75-3.27C9.98 4.04 14 4.03 17.15 5.65c1.5.77 2.76 1.86 3.75 3.27.16.22.11.54-.12.7-.23.16-.54.11-.7-.12-.9-1.29-2.04-2.25-3.39-2.94-2.87-1.47-6.54-1.47-9.4.01-1.36.7-2.5 1.65-3.4 2.94-.08.14-.23.21-.39.21z"/>
                            <path d="M9.75 21.79c-.13 0-.26-.05-.35-.15-.87-.87-1.34-1.43-2.01-2.64-.69-1.24-1.16-2.45-1.38-3.50-.25-1.19-.28-2.46-.02-3.64.24-1.07.7-2.04 1.33-2.79.59-.70 1.42-1.29 2.39-1.70.03-.01.06-.02.09-.02.79-.22 1.63-.33 2.49-.33s1.70.11 2.49.33c.03 0 .06.01.09.02.97.41 1.80 1.00 2.39 1.70.63.75 1.09 1.72 1.33 2.79.26 1.18.23 2.45-.02 3.64-.22 1.05-.69 2.26-1.38 3.50-.67 1.21-1.14 1.77-2.01 2.64-.18.18-.47.18-.65 0z"/>
                        </svg>
                    </div>

                    <!-- Success Animation -->
                    <div id="successAnimation" class="hidden absolute inset-0 w-32 h-32 mx-auto rounded-full bg-green-500 flex items-center justify-center shadow-xl border-2 border-green-200">
                        <svg class="w-16 h-16 text-white" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="space-y-1">
                    <h2 id="biometricTitle" class="text-2xl font-bold text-gray-800">Admin Biometric Login</h2>
                    <p id="biometricSubtitle" class="text-gray-600">Touch the sensor to authenticate</p>
                </div>

                <!-- Status -->
                <div id="biometricStatus" class="text-sm text-gray-500 bg-white/40 backdrop-blur-sm rounded-full px-4 py-2 mx-auto inline-block">
                    Place your finger on the sensor
                </div>

                <!-- Alternative Login -->
                <button id="altLoginBtn" onclick="showPasswordLogin()" class="text-[rgb(var(--accent-2))] text-sm underline font-medium hover:opacity-80 transition-colors">
                    Use password instead
                </button>

                <!-- Password Login (Hidden) -->
                <div id="passwordLogin" class="hidden space-y-4">
                    <div class="space-y-3">
                        <input type="email" value="admin@unisync.ac.za" class="w-full p-3 rounded-xl border border-[rgb(var(--accent))/30] text-center bg-white shadow-sm text-gray-700 text-sm" readonly>
                        <div class="relative">
                            <input type="password" id="loginPassword" placeholder="Enter your password" class="w-full p-3 pr-10 rounded-xl border border-[rgb(var(--accent))/30] text-center bg-white shadow-sm text-sm">
                            <button type="button" onclick="togglePassword()" class="absolute right-3 top-3 p-1 text-gray-400 hover:text-gray-600">
                                <svg id="eyeIcon" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button onclick="passwordLogin()" class="w-full p-3 rounded-xl bg-[rgb(var(--accent-2))] text-white font-semibold animate-press ripple shadow-md hover:opacity-90 transition-colors">
                        Login
                    </button>
                    <button onclick="showBiometricLogin()" class="text-[rgb(var(--accent-2))] text-sm underline font-medium hover:opacity-80 transition-colors">
                        Back to biometric
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Sheet -->
        <aside id="settingsSheet" class="hidden absolute inset-x-0 bottom-0 max-h-[70%] rounded-t-3xl bg-[rgb(var(--surface))] elevate overflow-hidden z-40">
            <div class="px-4 py-3 border-b border-black/10 flex items-center justify-between">
                <h3 class="font-semibold">Admin Settings</h3>
                <button class="p-2 rounded-full hover:bg-black/5 animate-press ripple" onclick="closeSettings()">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/></svg>
                </button>
            </div>
            <div class="p-4 space-y-3 text-sm overflow-y-auto">
                <div class="rounded-2xl bg-white p-3 flex items-center justify-between">
                    <div>
                        <div class="font-medium">Biometric Login</div>
                        <div class="text-xs text-black/60">Enable fingerprint and face recognition login</div>
                    </div>
                    <input type="checkbox" id="biometricToggle" checked onchange="toggleBiometric(this.checked)" class="w-4 h-4">
                </div>
                <div class="rounded-2xl bg-white p-3 flex items-center justify-between">
                    <div>
                        <div class="font-medium">Real-time Alerts</div>
                        <div class="text-xs text-black/60">Get notified of system changes</div>
                    </div>
                    <input type="checkbox" id="alertsToggle" checked onchange="toggleAlerts(this.checked)" class="w-4 h-4">
                </div>
                <div class="rounded-2xl bg-white p-3 flex items-center justify-between">
                    <div>
                        <div class="font-medium">System Monitoring</div>
                        <div class="text-xs text-black/60">Monitor system performance</div>
                    </div>
                    <input type="checkbox" id="systemToggle" checked onchange="toggleSystemMonitoring(this.checked)" class="w-4 h-4">
                </div>
                <div class="rounded-2xl bg-white p-3 flex items-center justify-between">
                    <div>
                        <div class="font-medium">GPS Location Tracking</div>
                        <div class="text-xs text-black/60">Enable location verification for attendance</div>
                    </div>
                    <input type="checkbox" id="gpsToggle" checked onchange="toggleGPS(this.checked)" class="w-4 h-4">
                </div>
                <div class="rounded-2xl bg-white p-3 flex items-center justify-between">
                    <div>
                        <div class="font-medium">Geo-Fencing</div>
                        <div class="text-xs text-black/60">Restrict attendance to campus locations</div>
                    </div>
                    <input type="checkbox" id="geoFenceToggle" checked onchange="toggleGeoFencing(this.checked)" class="w-4 h-4">
                </div>
                <div class="rounded-2xl bg-white p-3">
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <div class="font-medium">Location Radius</div>
                            <div class="text-xs text-black/60">Allowed distance from venue (meters)</div>
                        </div>
                        <span id="radiusValue" class="text-sm font-medium">100m</span>
                    </div>
                    <input type="range" id="radiusSlider" min="50" max="500" value="100" step="25" onchange="updateRadius(this.value)" class="w-full">
                </div>
                <div class="rounded-2xl bg-white p-3 flex items-center justify-between">
                    <div>
                        <div class="font-medium">Language</div>
                        <div class="text-xs text-black/60">Switch the app language</div>
                    </div>
                    <select class="rounded-xl border border-black/10 px-2 py-1" onchange="setLanguage(this.value)">
                        <option>English</option>
                        <option>isiZulu</option>
                    </select>
                </div>
                <div class="rounded-2xl bg-white p-3">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="font-medium">Theme</div>
                            <div class="text-xs text-black/60">Choose your look</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="px-3 py-1.5 rounded-lg bg-black/10 text-xs animate-press ripple" onclick="applyTheme('lilac')">Light</button>
                            <button class="px-3 py-1.5 rounded-lg bg-black/10 text-xs animate-press ripple" onclick="applyTheme('ink')">Dark</button>
                            <button class="px-3 py-1.5 rounded-lg bg-black/10 text-xs animate-press ripple" onclick="applyTheme('mint')">Mint</button>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- User Management Modal -->
        <div id="userModal" class="hidden absolute inset-0 bg-black/30 z-50">
            <div class="absolute inset-x-0 bottom-0 max-h-[80%] rounded-t-3xl bg-[rgb(var(--surface))] elevate overflow-hidden">
                <div class="px-4 py-3 border-b border-black/10 flex items-center justify-between">
                    <h3 class="font-semibold">User Management</h3>
                    <button class="p-2 rounded-full hover:bg-black/5 animate-press ripple" onclick="closeUserModal()">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/></svg>
                    </button>
                </div>
                <div class="p-4 space-y-4 overflow-y-auto max-h-[calc(80vh-60px)]">
                    <div id="userInfo" class="rounded-2xl bg-[rgb(var(--card))] p-3">
                        <!-- User info will be populated here -->
                    </div>
                    <div class="space-y-3">
                        <button onclick="resetUserPassword()" class="w-full p-3 rounded-xl bg-[rgb(var(--warn))] text-white font-medium animate-press ripple">
                            Reset Password
                        </button>
                        <button onclick="toggleUserStatus()" class="w-full p-3 rounded-xl bg-[rgb(var(--accent-2))] text-white font-medium animate-press ripple">
                            Toggle User Status
                        </button>
                        <button onclick="viewUserActivity()" class="w-full p-3 rounded-xl bg-[rgb(var(--card))] font-medium animate-press ripple">
                            View Activity Log
                        </button>
                        <button onclick="viewUserLocation()" class="w-full p-3 rounded-xl bg-green-500 text-white font-medium animate-press ripple">
                            View Location History
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location Analytics Modal -->
        <div id="locationModal" class="hidden absolute inset-0 bg-black/30 z-50">
            <div class="absolute inset-x-0 bottom-0 max-h-[85%] rounded-t-3xl bg-[rgb(var(--surface))] elevate overflow-hidden">
                <div class="px-4 py-3 border-b border-black/10 flex items-center justify-between">
                    <h3 class="font-semibold">Location Analytics</h3>
                    <button class="p-2 rounded-full hover:bg-black/5 animate-press ripple" onclick="closeLocationModal()">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/></svg>
                    </button>
                </div>
                <div id="locationContent" class="p-4 space-y-4 overflow-y-auto max-h-[calc(85vh-60px)]">
                    <!-- Location analytics content will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // State
    const state = {
      view: 'dashboard',
      selectedUser: null,
      alertsEnabled: true,
      biometricEnabled: true,
      systemMonitoring: true,
      lastUpdate: Date.now(),
      systemStats: {
        totalUsers: 1247,
        activeUsers: 892,
        totalLecturers: 45,
        activeLecturers: 38,
        totalStudents: 1202,
        activeStudents: 854,
        systemUptime: '99.8%',
        sessionCount: 15420,
        attendanceRate: 78,
        gpsAccuracy: 95.2,
        locationVerified: 89,
        geoFenceViolations: 3
      },
      locationSettings: {
        gpsEnabled: true,
        geoFencing: true,
        locationRadius: 100,
        strictMode: false,
        trackingAccuracy: 'high'
      },
      recentActivity: [
        { type: 'login', user: 'Dr. Smith', time: '2 min ago', status: 'success', location: 'Main Campus' },
        { type: 'attendance', user: 'Alice Johnson', time: '5 min ago', status: 'success', location: 'Lecture Hall A' },
        { type: 'qr_scan', user: 'Bob Wilson', time: '8 min ago', status: 'success', location: 'Library' },
        { type: 'geo_violation', user: 'Unknown', time: '12 min ago', status: 'warning', location: 'Off Campus' },
        { type: 'gps_sync', user: 'System', time: '15 min ago', status: 'info', location: 'All Venues' }
      ],
      users: [
        {
          id: 'L001',
          name: 'Dr. Sarah Smith',
          email: 'sarah.smith@unisync.ac.za',
          role: 'Lecturer',
          department: 'Computer Science',
          status: 'active',
          lastLogin: '2 hours ago',
          loginCount: 156,
          lastLocation: 'Main Campus - Building A',
          locationAccuracy: 98.5
        },
        {
          id: 'L002',
          name: 'Prof. Michael Johnson',
          email: 'michael.johnson@unisync.ac.za',
          role: 'Lecturer',
          department: 'Information Systems',
          status: 'active',
          lastLogin: '1 day ago',
          loginCount: 89,
          lastLocation: 'Main Campus - Building B',
          locationAccuracy: 94.2
        },
        {
          id: 'S001',
          name: 'Alice Thompson',
          email: 'alice.thompson@student.ac.za',
          role: 'Student',
          department: 'Computer Science',
          status: 'active',
          lastLogin: '30 min ago',
          loginCount: 234,
          lastLocation: 'Library - 2nd Floor',
          locationAccuracy: 96.8
        },
        {
          id: 'S002',
          name: 'David Wilson',
          email: 'david.wilson@student.ac.za',
          role: 'Student',
          department: 'Information Systems',
          status: 'inactive',
          lastLogin: '3 days ago',
          loginCount: 45,
          lastLocation: 'Student Center',
          locationAccuracy: 91.3
        }
      ],
      locationData: {
        venues: [
          { name: 'Lecture Hall A', checkins: 234, accuracy: 97.2, violations: 2 },
          { name: 'Lecture Hall B', checkins: 189, accuracy: 95.8, violations: 1 },
          { name: 'Library', checkins: 156, accuracy: 98.1, violations: 0 },
          { name: 'Computer Lab', checkins: 98, accuracy: 94.5, violations: 3 },
          { name: 'Student Center', checkins: 67, accuracy: 92.3, violations: 1 }
        ]
      }
    };

    const screen = document.getElementById('screen');
    const headerTitle = document.getElementById('headerTitle');
    const backBtn = document.getElementById('backBtn');

    // Biometric Login Functions (Same as lecturer version)
    function showBiometricAuth() {
      if (!state.biometricEnabled) {
        showToast('Biometric login is disabled');
        return;
      }
    }

    function startBiometricScan() {
      if (!state.biometricEnabled) {
        showToast('Biometric login is disabled');
        return;
      }

      if (navigator.vibrate) {
        navigator.vibrate(200);
      }

      const fingerprintBtn = document.getElementById('fingerprintButton');
      const successAnim = document.getElementById('successAnimation');
      const status = document.getElementById('biometricStatus');
      const title = document.getElementById('biometricTitle');
      const subtitle = document.getElementById('biometricSubtitle');

      fingerprintBtn.style.transform = 'scale(0.95)';
      fingerprintBtn.style.opacity = '0.8';
      status.textContent = 'Scanning fingerprint...';
      status.className = 'text-sm text-[rgb(var(--accent-2))]';

      setTimeout(() => {
        fingerprintBtn.classList.add('hidden');
        successAnim.classList.remove('hidden');

        if (navigator.vibrate) {
          navigator.vibrate([100, 50, 100]);
        }

        title.textContent = 'Admin Access Granted';
        subtitle.textContent = 'Authentication verified';
        status.textContent = 'Welcome back, Administrator';
        status.className = 'text-sm text-[rgb(var(--success))] font-medium';

        setTimeout(() => {
          document.getElementById('biometricScreen').classList.add('hidden');
          document.getElementById('appHeader').classList.remove('hidden');
          document.getElementById('screen').classList.remove('hidden');
          showAlert('Admin biometric login successful', 'success');
        }, 2000);
      }, 2000);
    }

    function showPasswordLogin() {
      document.getElementById('fingerprintButton').parentElement.classList.add('hidden');
      document.getElementById('biometricTitle').textContent = 'Admin Password Login';
      document.getElementById('biometricSubtitle').textContent = 'Enter your credentials';
      document.getElementById('biometricStatus').classList.add('hidden');
      document.getElementById('altLoginBtn').classList.add('hidden');
      document.getElementById('passwordLogin').classList.remove('hidden');
    }

    function showBiometricLogin() {
      document.getElementById('fingerprintButton').parentElement.classList.remove('hidden');
      document.getElementById('biometricTitle').textContent = 'Admin Biometric Login';
      document.getElementById('biometricSubtitle').textContent = 'Touch the sensor to authenticate';
      document.getElementById('biometricStatus').classList.remove('hidden');
      document.getElementById('altLoginBtn').classList.remove('hidden');
      document.getElementById('passwordLogin').classList.add('hidden');
    }

    function passwordLogin() {
      const password = document.getElementById('loginPassword').value;
      if (!password) {
        showToast('Please enter your password');
        return;
      }

      const status = document.getElementById('biometricStatus');
      status.classList.remove('hidden');
      status.textContent = 'Verifying admin credentials...';
      status.className = 'text-sm text-[rgb(var(--accent-2))]';

      setTimeout(() => {
        status.textContent = 'Admin access granted!';
        status.className = 'text-sm text-[rgb(var(--success))] font-medium';

        setTimeout(() => {
          document.getElementById('biometricScreen').classList.add('hidden');
          document.getElementById('appHeader').classList.remove('hidden');
          document.getElementById('screen').classList.remove('hidden');
          showAlert('Admin password login successful', 'success');
        }, 1500);
      }, 1500);
    }

    function togglePassword() {
      const passwordInput = document.getElementById('loginPassword');
      const eyeIcon = document.getElementById('eyeIcon');

      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeIcon.innerHTML = '<path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>';
      } else {
        passwordInput.type = 'password';
        eyeIcon.innerHTML = '<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';
      }
    }

    function toggleBiometric(enabled) {
      state.biometricEnabled = enabled;
      localStorage.setItem('biometricEnabled', enabled);
      showToast(enabled ? 'Biometric login enabled' : 'Biometric login disabled');
    }

    function toggleSystemMonitoring(enabled) {
      state.systemMonitoring = enabled;
      localStorage.setItem('systemMonitoring', enabled);
      showToast(enabled ? 'System monitoring enabled' : 'System monitoring disabled');
    }

    function toggleGPS(enabled) {
      state.locationSettings.gpsEnabled = enabled;
      localStorage.setItem('gpsEnabled', enabled);
      showToast(enabled ? 'GPS tracking enabled' : 'GPS tracking disabled');
      if (enabled) {
        showAlert('GPS location tracking activated for all users', 'info');
      } else {
        showAlert('GPS location tracking disabled', 'warning');
      }
    }

    function toggleGeoFencing(enabled) {
      state.locationSettings.geoFencing = enabled;
      localStorage.setItem('geoFencing', enabled);
      showToast(enabled ? 'Geo-fencing enabled' : 'Geo-fencing disabled');
      if (enabled) {
        showAlert('Geo-fence boundaries activated', 'success');
      }
    }

    function updateRadius(value) {
      state.locationSettings.locationRadius = parseInt(value);
      document.getElementById('radiusValue').textContent = value + 'm';
      localStorage.setItem('locationRadius', value);
      showToast(`Location radius set to ${value}m`);
    }

    // Real-time Alert System
    function showAlert(message, type = 'info', duration = 5000) {
      if (!state.alertsEnabled) return;

      const alertContainer = document.getElementById('alertContainer');
      const alertId = 'alert-' + Date.now();

      const typeStyles = {
        info: 'bg-[rgb(var(--accent-2))] text-white',
        success: 'bg-[rgb(var(--success))] text-white',
        warning: 'bg-[rgb(var(--warn))] text-white',
        danger: 'bg-[rgb(var(--danger))] text-white'
      };

      const alertElement = document.createElement('div');
      alertElement.id = alertId;
      alertElement.className = `p-3 rounded-xl ${typeStyles[type]} elevate alert-enter flex items-center justify-between text-sm`;
      alertElement.innerHTML = `
        <div class="flex items-center gap-2">
          <div class="w-2 h-2 bg-white rounded-full live-indicator"></div>
          <span>${message}</span>
        </div>
        <button onclick="dismissAlert('${alertId}')" class="p-1 rounded-full hover:bg-white/20">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/>
          </svg>
        </button>
      `;

      alertContainer.appendChild(alertElement);

      setTimeout(() => {
        dismissAlert(alertId);
      }, duration);
    }

    function dismissAlert(alertId) {
      const alert = document.getElementById(alertId);
      if (alert) {
        alert.classList.remove('alert-enter');
        alert.classList.add('alert-exit');
        setTimeout(() => {
          alert.remove();
        }, 300);
      }
    }

    function toggleAlerts(enabled) {
      state.alertsEnabled = enabled;
      localStorage.setItem('alertsEnabled', enabled);
      showToast(enabled ? 'Alerts enabled' : 'Alerts disabled');
    }

    // Simulate real-time system updates with location events
    function simulateRealTimeUpdates() {
      setInterval(() => {
        if (Math.random() < 0.15) { // 15% chance every 10 seconds
          const events = [
            { message: 'New user registration', type: 'info' },
            { message: 'GPS sync completed for all venues', type: 'success' },
            { message: 'Geo-fence violation detected', type: 'warning' },
            { message: 'Location accuracy improved to 98%', type: 'success' },
            { message: 'QR scan with GPS verification', type: 'info' },
            { message: 'User outside allowed radius', type: 'warning' }
          ];

          const randomEvent = events[Math.floor(Math.random() * events.length)];
          showAlert(randomEvent.message, randomEvent.type);

          // Update stats
          state.systemStats.sessionCount += Math.floor(Math.random() * 50) + 10;
          state.systemStats.activeUsers += Math.floor(Math.random() * 3) - 1;
          state.systemStats.gpsAccuracy = Math.min(99.9, state.systemStats.gpsAccuracy + (Math.random() * 0.5 - 0.2));
          state.systemStats.locationVerified = Math.max(80, Math.min(95, state.systemStats.locationVerified + Math.floor(Math.random() * 3) - 1));

          if (state.view === 'dashboard') {
            render();
          }
        }
      }, 10000);
    }

    // Helpers
    const showToast = (msg = 'Action completed!') => {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.remove('hidden');
      setTimeout(() => t.classList.add('hidden'), 2000);
    };

    const chip = (text, tone = 'accent') => {
      const tones = {
        accent: 'bg-[rgb(var(--accent))/15] text-[rgb(var(--accent-2))]',
        good: 'bg-[rgb(var(--success))/18] text-[rgb(var(--success))]',
        warn: 'bg-[rgb(var(--warn))/18] text-[rgb(var(--warn))]',
        danger: 'bg-[rgb(var(--danger))/18] text-[rgb(var(--danger))]',
        mute: 'bg-black/10 text-black/70'
      };
      return `<span class="px-2.5 py-1 rounded-full text-xs font-medium ${tones[tone] || tones.accent}">${text}</span>`;
    };

    // Generate real-time charts with location data
    function generateSystemChart() {
      const uptime = parseFloat(state.systemStats.systemUptime);
      const gpsAccuracy = state.systemStats.gpsAccuracy;
      const locationVerified = state.systemStats.locationVerified;

      return `
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <span class="text-sm">System Uptime</span>
            <span class="font-medium">${state.systemStats.systemUptime}</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-[rgb(var(--success))] h-2 rounded-full chart-bar" style="width: ${uptime}%"></div>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm">GPS Accuracy</span>
            <span class="font-medium">${gpsAccuracy.toFixed(1)}%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-blue-500 h-2 rounded-full chart-bar" style="width: ${gpsAccuracy}%"></div>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm">Location Verified</span>
            <span class="font-medium">${locationVerified}%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-purple-500 h-2 rounded-full chart-bar" style="width: ${locationVerified}%"></div>
          </div>
        </div>
      `;
    }

    // Screens
    function dashboardScreen() {
      headerTitle.textContent = 'UniSync Admin';
      backBtn.classList.add('hidden');

      return `
        <div class="space-y-4">
          <!-- System Status Banner -->
          <div class="rounded-3xl bg-gradient-to-r from-[rgb(var(--success))] to-green-600 p-4 text-white">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-semibold text-lg">System Status</div>
                <div class="text-sm opacity-90">All systems operational</div>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-white rounded-full live-indicator"></div>
                <span class="text-sm">Live</span>
              </div>
            </div>
          </div>

          <!-- Real-time Stats Grid -->
          <div class="grid grid-cols-2 gap-3">
            <div class="rounded-2xl bg-white p-4 elevate text-center">
              <div class="text-2xl font-bold text-[rgb(var(--accent-2))] count-up">${state.systemStats.totalUsers}</div>
              <div class="text-xs text-black/60">Total Users</div>
              <div class="text-xs text-[rgb(var(--success))] mt-1">+12 today</div>
            </div>
            <div class="rounded-2xl bg-white p-4 elevate text-center">
              <div class="text-2xl font-bold text-[rgb(var(--success))] count-up">${state.systemStats.activeUsers}</div>
              <div class="text-xs text-black/60">Active Now</div>
              <div class="text-xs text-[rgb(var(--success))] mt-1">+5 online</div>
            </div>
            <div class="rounded-2xl bg-white p-4 elevate text-center">
              <div class="text-2xl font-bold text-[rgb(var(--warn))] count-up">${state.systemStats.sessionCount}</div>
              <div class="text-xs text-black/60">Sessions</div>
              <div class="text-xs text-[rgb(var(--accent))] mt-1">Today</div>
            </div>
            <div class="rounded-2xl bg-white p-4 elevate text-center">
              <div class="text-2xl font-bold text-[rgb(var(--danger))] count-up">${state.systemStats.attendanceRate}%</div>
              <div class="text-xs text-black/60">Attendance</div>
              <div class="text-xs text-[rgb(var(--success))] mt-1">+2% today</div>
            </div>
          </div>

          <!-- Location Tracking Stats -->
          <div class="grid grid-cols-3 gap-3">
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-lg font-bold text-blue-600 count-up">${state.systemStats.gpsAccuracy.toFixed(1)}%</div>
              <div class="text-xs text-black/60">GPS Accuracy</div>
              <div class="flex items-center justify-center mt-1">
                <svg class="w-3 h-3 text-blue-500 gps-signal" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M3.05,13H1V11H3.05C3.5,6.83 6.83,3.5 11,3.05V1H13V3.05C17.17,3.5 20.5,6.83 20.95,11H23V13H20.95C20.5,17.17 17.17,20.5 13,20.95V23H11V20.95C6.83,20.5 3.5,17.17 3.05,13M12,5A7,7 0 0,0 5,12A7,7 0 0,0 12,19A7,7 0 0,0 19,12A7,7 0 0,0 12,5Z"/>
                </svg>
              </div>
            </div>
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-lg font-bold text-green-600 count-up">${state.systemStats.locationVerified}%</div>
              <div class="text-xs text-black/60">Verified</div>
              <div class="text-xs text-[rgb(var(--success))] mt-1">Location</div>
            </div>
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-lg font-bold text-red-600 count-up">${state.systemStats.geoFenceViolations}</div>
              <div class="text-xs text-black/60">Violations</div>
              <div class="text-xs text-[rgb(var(--danger))] mt-1">Today</div>
            </div>
          </div>

          <!-- System Performance Chart -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">System Performance</h3>
              <div class="flex items-center gap-1">
                <div class="w-2 h-2 bg-[rgb(var(--success))] rounded-full live-indicator"></div>
                <span class="text-xs text-black/50">Real-time</span>
              </div>
            </div>
            ${generateSystemChart()}
          </div>

          <!-- Location Analytics -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Location Analytics</h3>
              <button onclick="showLocationAnalytics()" class="text-[rgb(var(--accent-2))] text-sm font-medium">View All</button>
            </div>
            <div class="space-y-3">
              ${state.locationData.venues.slice(0, 3).map(venue => `
                <div class="flex items-center justify-between p-3 rounded-2xl bg-[rgb(var(--card))]">
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-white text-xs grid place-items-center">
                      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12,2C15.31,2 18,4.66 18,7.95C18,12.41 12,19 12,19S6,12.41 6,7.95C6,4.66 8.69,2 12,2M12,6A2,2 0 0,0 10,8A2,2 0 0,0 12,10A2,2 0 0,0 14,8A2,2 0 0,0 12,6Z"/>
                      </svg>
                    </div>
                    <div>
                      <div class="font-medium text-sm">${venue.name}</div>
                      <div class="text-xs text-black/60">${venue.checkins} check-ins • ${venue.accuracy}% accuracy</div>
                    </div>
                  </div>
                  ${venue.violations > 0 ? chip(venue.violations + ' violations', 'warn') : chip('Clean', 'good')}
                </div>
              `).join('')}
            </div>
          </div>

          <!-- System Health Status -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">System Health Status</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 rounded-2xl bg-[rgb(var(--success))/10]">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full bg-[rgb(var(--success))] text-white text-xs grid place-items-center">SYS</div>
                  <div>
                    <div class="font-medium text-sm">System Status</div>
                    <div class="text-xs text-black/60">All services running normally</div>
                  </div>
                </div>
                ${chip('Healthy', 'good')}
              </div>
              <div class="flex items-center justify-between p-3 rounded-2xl bg-[rgb(var(--accent))/10]">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full bg-[rgb(var(--accent-2))] text-white text-xs grid place-items-center">GPS</div>
                  <div>
                    <div class="font-medium text-sm">GPS Tracking</div>
                    <div class="text-xs text-black/60">Location services active</div>
                  </div>
                </div>
                ${chip('Active', 'good')}
              </div>
              <div class="flex items-center justify-between p-3 rounded-2xl bg-blue-50">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full bg-blue-500 text-white text-xs grid place-items-center">GEO</div>
                  <div>
                    <div class="font-medium text-sm">Geo-Fencing</div>
                    <div class="text-xs text-black/60">Boundary monitoring enabled</div>
                  </div>
                </div>
                ${chip('Monitoring', 'accent')}
              </div>
            </div>
          </div>

          <!-- Quick Admin Actions -->
          <div class="rounded-3xl bg-[rgb(var(--card))] p-4 elevate">
            <h3 class="font-semibold mb-3">Quick Actions</h3>
            <div class="space-y-2">
              <button class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple" onclick="showUsers()">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">User Management</div>
                    <div class="text-xs text-black/60">Manage lecturers and students</div>
                  </div>
                  <svg class="w-5 h-5 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A2.996 2.996 0 0 0 17.06 6c-.8 0-1.54.5-1.85 1.26l-1.92 5.77c-.24.71.11 1.49.78 1.75l2.28.91V22h-1.5v-6H12l-2.54-7.63A2.996 2.996 0 0 0 6.56 6c-.8 0-1.54.5-1.85 1.26L2.78 13.03c-.24.71.11 1.49.78 1.75L5.84 15.7V22H4.34v-6H1.5V9.5c0-.83.67-1.5 1.5-1.5h2.5c.83 0 1.5.67 1.5 1.5V16h1.5v-6.5c0-.83.67-1.5 1.5-1.5h2.5c.83 0 1.5.67 1.5 1.5V22h1.5z"/>
                  </svg>
                </div>
              </button>
              <button class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple" onclick="showLocationAnalytics()">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Location Analytics</div>
                    <div class="text-xs text-black/60">GPS data and geo-fence reports</div>
                  </div>
                  <svg class="w-5 h-5 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12,2C15.31,2 18,4.66 18,7.95C18,12.41 12,19 12,19S6,12.41 6,7.95C6,4.66 8.69,2 12,2M12,6A2,2 0 0,0 10,8A2,2 0 0,0 12,10A2,2 0 0,0 14,8A2,2 0 0,0 12,6Z"/>
                  </svg>
                </div>
              </button>
              <button class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple" onclick="showReports()">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">System Reports</div>
                    <div class="text-xs text-black/60">Generate comprehensive reports</div>
                  </div>
                  <svg class="w-5 h-5 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                  </svg>
                </div>
              </button>
              <button class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple" onclick="showSystemLogs()">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">System Logs</div>
                    <div class="text-xs text-black/60">View detailed system activity</div>
                  </div>
                  <svg class="w-5 h-5 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                  </svg>
                </div>
              </button>
            </div>
          </div>

          <!-- Recent System Activity -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Recent Activity</h3>
              <div class="flex items-center gap-1">
                <div class="w-2 h-2 bg-[rgb(var(--success))] rounded-full live-indicator"></div>
                <span class="text-xs text-black/50">Live</span>
              </div>
            </div>
            <div class="space-y-3">
              ${state.recentActivity.slice(0, 4).map(activity => {
                const statusColors = {
                  success: 'bg-[rgb(var(--success))]',
                  warning: 'bg-[rgb(var(--warn))]',
                  info: 'bg-[rgb(var(--accent-2))]'
                };
                return `
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <div class="w-2 h-2 rounded-full ${statusColors[activity.status] || statusColors.info}"></div>
                      <div>
                        <div class="font-medium text-sm">${activity.user}</div>
                        <div class="text-xs text-black/60">${activity.type.replace('_', ' ')} • ${activity.location || 'Unknown'}</div>
                      </div>
                    </div>
                    <div class="text-xs text-black/50">${activity.time}</div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function usersScreen() {
      headerTitle.textContent = 'User Management';
      backBtn.classList.remove('hidden');

      return `
        <div class="space-y-4">
          <!-- User Stats -->
          <div class="grid grid-cols-3 gap-3">
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-xl font-bold text-[rgb(var(--accent-2))]">${state.systemStats.totalLecturers}</div>
              <div class="text-xs text-black/60">Lecturers</div>
            </div>
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-xl font-bold text-[rgb(var(--success))]">${state.systemStats.totalStudents}</div>
              <div class="text-xs text-black/60">Students</div>
            </div>
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-xl font-bold text-[rgb(var(--warn))]">${state.systemStats.activeUsers}</div>
              <div class="text-xs text-black/60">Active</div>
            </div>
          </div>

          <!-- Search Bar -->
          <div class="rounded-2xl bg-white p-3 elevate">
            <div class="relative">
              <input type="text" placeholder="Search users..." class="w-full pl-10 pr-4 py-2 rounded-xl border border-black/10 text-sm">
              <svg class="absolute left-3 top-2.5 w-4 h-4 text-black/40" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
            </div>
          </div>

          <!-- Users List -->
          <div class="space-y-3">
            ${state.users.map(user => `
              <div class="rounded-2xl bg-white p-4 elevate">
                <div class="flex items-start justify-between">
                  <div class="flex items-start gap-3 flex-1">
                    <div class="w-12 h-12 rounded-2xl ${user.role === 'Lecturer' ? 'bg-gradient-to-br from-blue-500 to-blue-600' : 'bg-gradient-to-br from-green-500 to-green-600'} text-white font-medium grid place-items-center relative">
                      ${user.name.split(' ').map(n => n[0]).join('')}
                      ${user.status === 'active' ? '<div class="absolute -top-1 -right-1 w-3 h-3 bg-[rgb(var(--success))] rounded-full live-indicator"></div>' : ''}
                    </div>
                    <div class="flex-1">
                      <div class="font-semibold">${user.name}</div>
                      <div class="text-sm text-black/60">${user.role} • ${user.department}</div>
                      <div class="text-xs text-black/50 mt-1">${user.email}</div>
                      <div class="text-xs text-black/50 flex items-center gap-2 mt-1">
                        <svg class="w-3 h-3 text-blue-500" viewBox="0 0 24 24" fill="currentColor">
                          <path d="M12,2C15.31,2 18,4.66 18,7.95C18,12.41 12,19 12,19S6,12.41 6,7.95C6,4.66 8.69,2 12,2M12,6A2,2 0 0,0 10,8A2,2 0 0,0 12,10A2,2 0 0,0 14,8A2,2 0 0,0 12,6Z"/>
                        </svg>
                        <span>${user.lastLocation}</span>
                      </div>
                      <div class="mt-2 flex items-center gap-2">
                        ${user.status === 'active' ? chip('Active', 'good') : chip('Inactive', 'mute')}
                        ${chip(user.locationAccuracy.toFixed(1) + '% GPS', 'accent')}
                        <span class="text-xs text-black/50">Last login: ${user.lastLogin}</span>
                      </div>
                    </div>
                  </div>
                  <button onclick="openUserModal('${user.id}')" class="p-2 rounded-xl bg-[rgb(var(--accent))/15] text-[rgb(var(--accent-2))] hover:opacity-80 animate-press ripple" title="Manage User">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M19.14 12.94a1.5 1.5 0 000-1.88l1.38-1.07-1.5-2.6-1.7.35a5.53 5.53 0 00-1.6-.93l-.35-1.7h-3l-.35 1.7a5.53 5.53 0 00-1.6.93l-1.7-.35-1.5 2.6 1.38 1.07a1.5 1.5 0 000 1.88L4.27 14l1.5 2.6 1.7-.35c.47.4 1.02.72 1.6.93l.35 1.7h3l.35-1.7c.58-.21 1.13-.53 1.6-.93l1.7.35 1.5-2.6-1.38-1.06zM12 14.5A2.5 2.5 0 1114.5 12 2.5 2.5 0 0112 14.5z"/>
                    </svg>
                  </button>
                </div>
              </div>
            `).join('')}
          </div>

          <!-- Add User Button -->
          <button onclick="addNewUser()" class="w-full p-4 rounded-2xl bg-[rgb(var(--accent-2))] text-white font-medium animate-press ripple">
            Add New User
          </button>
        </div>
      `;
    }

    function locationAnalyticsScreen() {
      headerTitle.textContent = 'Location Analytics';
      backBtn.classList.remove('hidden');

      return `
        <div class="space-y-4">
          <!-- Location Overview -->
          <div class="grid grid-cols-3 gap-3">
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-xl font-bold text-blue-600">${state.systemStats.gpsAccuracy.toFixed(1)}%</div>
              <div class="text-xs text-black/60">GPS Accuracy</div>
            </div>
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-xl font-bold text-green-600">${state.systemStats.locationVerified}%</div>
              <div class="text-xs text-black/60">Verified</div>
            </div>
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-xl font-bold text-red-600">${state.systemStats.geoFenceViolations}</div>
              <div class="text-xs text-black/60">Violations</div>
            </div>
          </div>

          <!-- Geo-Fence Settings -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Geo-Fence Configuration</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span class="text-sm">GPS Tracking</span>
                <input type="checkbox" ${state.locationSettings.gpsEnabled ? 'checked' : ''} onchange="toggleGPS(this.checked)" class="w-4 h-4">
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm">Geo-Fencing</span>
                <input type="checkbox" ${state.locationSettings.geoFencing ? 'checked' : ''} onchange="toggleGeoFencing(this.checked)" class="w-4 h-4">
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm">Location Radius</span>
                <span class="font-medium">${state.locationSettings.locationRadius}m</span>
              </div>
              <input type="range" min="50" max="500" value="${state.locationSettings.locationRadius}" step="25" onchange="updateRadius(this.value)" class="w-full">
            </div>
          </div>

          <!-- Venue Analytics -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Venue Analytics</h3>
            <div class="space-y-3">
              ${state.locationData.venues.map(venue => `
                <div class="p-3 rounded-2xl bg-[rgb(var(--card))]">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-white text-xs grid place-items-center">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                          <path d="M12,2C15.31,2 18,4.66 18,7.95C18,12.41 12,19 12,19S6,12.41 6,7.95C6,4.66 8.69,2 12,2M12,6A2,2 0 0,0 10,8A2,2 0 0,0 12,10A2,2 0 0,0 14,8A2,2 0 0,0 12,6Z"/>
                        </svg>
                      </div>
                      <div>
                        <div class="font-medium text-sm">${venue.name}</div>
                        <div class="text-xs text-black/60">${venue.checkins} check-ins today</div>
                      </div>
                    </div>
                    ${venue.violations > 0 ? chip(venue.violations + ' violations', 'warn') : chip('Clean', 'good')}
                  </div>
                  <div class="space-y-2">
                    <div class="flex justify-between text-xs">
                      <span>GPS Accuracy</span>
                      <span>${venue.accuracy}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                      <div class="bg-blue-500 h-1.5 rounded-full" style="width: ${venue.accuracy}%"></div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Location Violations -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Recent Violations</h3>
            <div class="space-y-3">
              <div class="p-3 rounded-2xl bg-red-50">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                    <div>
                      <div class="font-medium text-sm">Student outside radius</div>
                      <div class="text-xs text-black/60">Alice Johnson • 250m from venue</div>
                    </div>
                  </div>
                  <div class="text-xs text-black/50">12 min ago</div>
                </div>
              </div>
              <div class="p-3 rounded-2xl bg-yellow-50">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                    <div>
                      <div class="font-medium text-sm">Low GPS accuracy</div>
                      <div class="text-xs text-black/60">Computer Lab • 67% accuracy</div>
                    </div>
                  </div>
                  <div class="text-xs text-black/50">25 min ago</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Export Location Data -->
          <button onclick="exportLocationData()" class="w-full p-4 rounded-2xl bg-[rgb(var(--accent-2))] text-white font-medium animate-press ripple">
            Export Location Data
          </button>
        </div>
      `;
    }

    function reportsScreen() {
      headerTitle.textContent = 'System Reports';
      backBtn.classList.remove('hidden');

      return `
        <div class="space-y-4">
          <!-- Report Summary -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-4">System Overview</h3>
            <div class="grid grid-cols-2 gap-4 text-center">
              <div>
                <div class="text-2xl font-bold text-[rgb(var(--accent-2))]">${state.systemStats.totalUsers}</div>
                <div class="text-xs text-black/60">Total Users</div>
              </div>
              <div>
                <div class="text-2xl font-bold text-[rgb(var(--success))]">${state.systemStats.systemUptime}</div>
                <div class="text-xs text-black/60">System Uptime</div>
              </div>
              <div>
                <div class="text-2xl font-bold text-[rgb(var(--warn))]">${state.systemStats.sessionCount}</div>
                <div class="text-xs text-black/60">Sessions Today</div>
              </div>
              <div>
                <div class="text-2xl font-bold text-[rgb(var(--accent))]">${state.systemStats.attendanceRate}%</div>
                <div class="text-xs text-black/60">Avg Attendance</div>
              </div>
            </div>
          </div>

          <!-- Real-time Performance -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-4">Real-time Performance</h3>
            ${generateSystemChart()}
          </div>

          <!-- Report Categories -->
          <div class="rounded-3xl bg-[rgb(var(--card))] p-4 elevate">
            <h3 class="font-semibold mb-4">Generate Reports</h3>
            <div class="space-y-2">
              <button onclick="generateReport('user-activity')" class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">User Activity Report</div>
                    <div class="text-xs text-black/60">Login patterns and usage statistics</div>
                  </div>
                  <svg class="w-5 h-5 text-blue-500" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A2.996 2.996 0 0 0 17.06 6c-.8 0-1.54.5-1.85 1.26l-1.92 5.77c-.24.71.11 1.49.78 1.75l2.28.91V22h-1.5v-6H12l-2.54-7.63A2.996 2.996 0 0 0 6.56 6c-.8 0-1.54.5-1.85 1.26L2.78 13.03c-.24.71.11 1.49.78 1.75L5.84 15.7V22H4.34v-6H1.5V9.5c0-.83.67-1.5 1.5-1.5h2.5c.83 0 1.5.67 1.5 1.5V16h1.5v-6.5c0-.83.67-1.5 1.5-1.5h2.5c.83 0 1.5.67 1.5 1.5V22h1.5z"/>
                  </svg>
                </div>
              </button>
              <button onclick="generateReport('attendance')" class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Attendance Analytics</div>
                    <div class="text-xs text-black/60">QR code usage and attendance trends</div>
                  </div>
                  <svg class="w-5 h-5 text-green-500" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                  </svg>
                </div>
              </button>
              <button onclick="generateReport('location-analytics')" class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Location Analytics</div>
                    <div class="text-xs text-black/60">GPS data and geo-fence analysis</div>
                  </div>
                  <svg class="w-5 h-5 text-purple-500" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12,2C15.31,2 18,4.66 18,7.95C18,12.41 12,19 12,19S6,12.41 6,7.95C6,4.66 8.69,2 12,2M12,6A2,2 0 0,0 10,8A2,2 0 0,0 12,10A2,2 0 0,0 14,8A2,2 0 0,0 12,6Z"/>
                  </svg>
                </div>
              </button>
              <button onclick="generateReport('system-performance')" class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">System Performance</div>
                    <div class="text-xs text-black/60">System uptime and performance metrics</div>
                  </div>
                  <svg class="w-5 h-5 text-orange-500" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                </div>
              </button>
              <button onclick="generateReport('security')" class="w-full p-3 rounded-2xl bg-white text-left hover:opacity-90 animate-press ripple">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">Security Audit</div>
                    <div class="text-xs text-black/60">Failed logins and security events</div>
                  </div>
                  <svg class="w-5 h-5 text-red-500" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11H16V16H8V11H9.2V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.4,8.7 10.4,10V11H13.6V10C13.6,8.7 12.8,8.2 12,8.2Z"/>
                  </svg>
                </div>
              </button>
            </div>
          </div>

          <!-- Export Options -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-4">Export Options</h3>
            <div class="grid grid-cols-2 gap-3">
              <button onclick="exportReport('pdf')" class="p-3 rounded-2xl bg-red-50 text-red-600 font-medium animate-press ripple">
                <svg class="w-6 h-6 mx-auto mb-1" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                </svg>
                <div class="text-sm">PDF Report</div>
              </button>
              <button onclick="exportReport('excel')" class="p-3 rounded-2xl bg-green-50 text-green-600 font-medium animate-press ripple">
                <svg class="w-6 h-6 mx-auto mb-1" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                </svg>
                <div class="text-sm">Excel Export</div>
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function systemLogsScreen() {
      headerTitle.textContent = 'System Logs';
      backBtn.classList.remove('hidden');

      return `
        <div class="space-y-4">
          <!-- Log Filters -->
          <div class="rounded-2xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Filter Logs</h3>
            <div class="space-y-3">
              <select class="w-full p-3 rounded-xl border border-black/10">
                <option>All Log Types</option>
                <option>Authentication</option>
                <option>User Activity</option>
                <option>Location Events</option>
                <option>Geo-fence Violations</option>
                <option>System Events</option>
                <option>System Errors</option>
              </select>
              <div class="grid grid-cols-2 gap-3">
                <input type="date" value="${new Date().toISOString().split('T')[0]}" class="p-3 rounded-xl border border-black/10">
                <select class="p-3 rounded-xl border border-black/10">
                  <option>Last 24 hours</option>
                  <option>Last 7 days</option>
                  <option>Last 30 days</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Live Log Stream -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Live Log Stream</h3>
              <div class="flex items-center gap-1">
                <div class="w-2 h-2 bg-[rgb(var(--success))] rounded-full live-indicator"></div>
                <span class="text-xs text-black/50">Live</span>
              </div>
            </div>
            <div class="space-y-2 max-h-64 overflow-y-auto">
              ${state.recentActivity.map(activity => {
                const logTypes = {
                  login: { color: 'text-blue-600', bg: 'bg-blue-50' },
                  attendance: { color: 'text-green-600', bg: 'bg-green-50' },
                  qr_scan: { color: 'text-purple-600', bg: 'bg-purple-50' },
                  geo_violation: { color: 'text-red-600', bg: 'bg-red-50' },
                  gps_sync: { color: 'text-blue-600', bg: 'bg-blue-50' },
                  system: { color: 'text-gray-600', bg: 'bg-gray-50' }
                };
                const style = logTypes[activity.type] || logTypes.system;
                return `
                  <div class="p-3 rounded-xl ${style.bg} text-sm">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full ${style.color.replace('text-', 'bg-')}"></span>
                        <span class="font-medium ${style.color}">${activity.type.toUpperCase().replace('_', ' ')}</span>
                      </div>
                      <span class="text-xs text-black/50">${activity.time}</span>
                    </div>
                    <div class="mt-1 text-black/70">${activity.user} - ${activity.type.replace('_', ' ')} • ${activity.location}</div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>

          <!-- System Health -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">System Health Metrics</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-sm">CPU Usage</span>
                <span class="font-medium">23%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-[rgb(var(--success))] h-2 rounded-full" style="width: 23%"></div>
              </div>

              <div class="flex justify-between items-center">
                <span class="text-sm">Memory Usage</span>
                <span class="font-medium">67%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-[rgb(var(--warn))] h-2 rounded-full" style="width: 67%"></div>
              </div>

              <div class="flex justify-between items-center">
                <span class="text-sm">GPS Service Load</span>
                <span class="font-medium">34%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-blue-500 h-2 rounded-full" style="width: 34%"></div>
              </div>

              <div class="flex justify-between items-center">
                <span class="text-sm">Disk Space</span>
                <span class="font-medium">45%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-[rgb(var(--accent-2))] h-2 rounded-full" style="width: 45%"></div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Actions
    function showUsers() {
      state.view = 'users';
      render();
    }

    function showLocationAnalytics() {
      state.view = 'locationAnalytics';
      render();
    }

    function showReports() {
      state.view = 'reports';
      render();
    }

    function showSystemLogs() {
      state.view = 'systemLogs';
      render();
    }

    function showSettings() {
      toggleSettings(true);
    }

    function goBack() {
      state.view = 'dashboard';
      render();
    }

    function openUserModal(userId) {
      const user = state.users.find(u => u.id === userId);
      if (!user) return;

      state.selectedUser = user;

      document.getElementById('userInfo').innerHTML = `
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-2xl ${user.role === 'Lecturer' ? 'bg-gradient-to-br from-blue-500 to-blue-600' : 'bg-gradient-to-br from-green-500 to-green-600'} text-white font-medium grid place-items-center">
            ${user.name.split(' ').map(n => n[0]).join('')}
          </div>
          <div>
            <div class="font-semibold">${user.name}</div>
            <div class="text-sm text-black/60">${user.role} • ${user.department}</div>
            <div class="text-xs text-black/50">${user.email}</div>
            <div class="text-xs text-black/50 flex items-center gap-1 mt-1">
              <svg class="w-3 h-3 text-blue-500" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,2C15.31,2 18,4.66 18,7.95C18,12.41 12,19 12,19S6,12.41 6,7.95C6,4.66 8.69,2 12,2M12,6A2,2 0 0,0 10,8A2,2 0 0,0 12,10A2,2 0 0,0 14,8A2,2 0 0,0 12,6Z"/>
              </svg>
              <span>${user.lastLocation}</span>
            </div>
            <div class="mt-2 flex items-center gap-2">
              ${user.status === 'active' ? chip('Active', 'good') : chip('Inactive', 'mute')}
              ${chip(user.locationAccuracy.toFixed(1) + '% GPS', 'accent')}
            </div>
          </div>
        </div>
      `;

      document.getElementById('userModal').classList.remove('hidden');
    }

    function closeUserModal() {
      document.getElementById('userModal').classList.add('hidden');
      state.selectedUser = null;
    }

    function resetUserPassword() {
      if (!state.selectedUser) return;
      showToast(`Password reset for ${state.selectedUser.name}`);
      showAlert(`Password reset email sent to ${state.selectedUser.name}`, 'info');
      closeUserModal();
    }

    function toggleUserStatus() {
      if (!state.selectedUser) return;
      const newStatus = state.selectedUser.status === 'active' ? 'inactive' : 'active';
      state.selectedUser.status = newStatus;
      showToast(`User ${newStatus === 'active' ? 'activated' : 'deactivated'}`);
      showAlert(`${state.selectedUser.name} account ${newStatus}`, newStatus === 'active' ? 'success' : 'warning');
      closeUserModal();
      render();
    }

    function viewUserActivity() {
      if (!state.selectedUser) return;
      showToast(`Viewing activity for ${state.selectedUser.name}`);
      closeUserModal();
    }

    function viewUserLocation() {
      if (!state.selectedUser) return;
      showToast(`Viewing location history for ${state.selectedUser.name}`);
      closeUserModal();
    }

    function addNewUser() {
      showToast('New user registration form opened');
    }

    function generateReport(type) {
      showToast(`Generating ${type.replace('-', ' ')} report...`);
      showAlert(`${type.replace('-', ' ')} report generation started`, 'info');
    }

    function exportReport(format) {
      showToast(`Exporting report as ${format.toUpperCase()}...`);
    }

    function exportLocationData() {
      showToast('Exporting location analytics data...');
      showAlert('Location data export started', 'info');
    }

    function closeLocationModal() {
      document.getElementById('locationModal').classList.add('hidden');
    }

    // Settings functions
    function toggleSettings(show = true) {
      const overlay = document.getElementById('overlay');
      const sheet = document.getElementById('settingsSheet');

      if (show) {
        overlay.classList.remove('hidden');
        sheet.classList.remove('hidden');
      } else {
        overlay.classList.add('hidden');
        sheet.classList.add('hidden');
      }
    }

    function closeSettings() {
      toggleSettings(false);
    }

    function setLanguage(lang) {
      localStorage.setItem('language', lang);
      showToast('Language updated');
    }

    function applyTheme(theme) {
      const frame = document.getElementById('frame');
      frame.classList.remove('theme-lilac', 'theme-ink', 'theme-mint');

      if (theme === 'ink') {
        frame.classList.add('theme-ink');
        document.documentElement.style.setProperty('--bg-1', '17 24 39');
        document.documentElement.style.setProperty('--bg-2', '31 41 55');
        document.documentElement.style.setProperty('--surface', '24 31 44');
        document.documentElement.style.setProperty('--card', '31 41 55');
        document.documentElement.style.setProperty('--ink', '236 253 245');
        document.documentElement.style.setProperty('--accent', '147 197 253');
        document.documentElement.style.setProperty('--accent-2', '59 130 246');
      } else if (theme === 'mint') {
        frame.classList.add('theme-mint');
        document.documentElement.style.setProperty('--bg-1', '236 253 245');
        document.documentElement.style.setProperty('--bg-2', '209 250 229');
        document.documentElement.style.setProperty('--surface', '255 255 255');
        document.documentElement.style.setProperty('--card', '209 250 229');
        document.documentElement.style.setProperty('--accent', '52 211 153');
        document.documentElement.style.setProperty('--accent-2', '16 185 129');
      } else {
        frame.classList.add('theme-lilac');
        document.documentElement.style.setProperty('--bg-1', '245 243 255');
        document.documentElement.style.setProperty('--bg-2', '237 233 254');
        document.documentElement.style.setProperty('--surface', '255 255 255');
        document.documentElement.style.setProperty('--card', '234 231 251');
        document.documentElement.style.setProperty('--ink', '26 26 31');
        document.documentElement.style.setProperty('--accent', '167 139 250');
        document.documentElement.style.setProperty('--accent-2', '139 92 246');
      }

      localStorage.setItem('theme', theme);
      showToast('Theme updated');
    }

    // Render
    function render() {
      if (state.view === 'dashboard') {
        screen.innerHTML = dashboardScreen();
      } else if (state.view === 'users') {
        screen.innerHTML = usersScreen();
      } else if (state.view === 'locationAnalytics') {
        screen.innerHTML = locationAnalyticsScreen();
      } else if (state.view === 'reports') {
        screen.innerHTML = reportsScreen();
      } else if (state.view === 'systemLogs') {
        screen.innerHTML = systemLogsScreen();
      }
    }

    // Init
    (function init() {
      const savedTheme = localStorage.getItem('theme') || 'lilac';
      const savedAlertsEnabled = localStorage.getItem('alertsEnabled') !== 'false';
      const savedBiometricEnabled = localStorage.getItem('biometricEnabled') !== 'false';
      const savedSystemMonitoring = localStorage.getItem('systemMonitoring') !== 'false';
      const savedGpsEnabled = localStorage.getItem('gpsEnabled') !== 'false';
      const savedGeoFencing = localStorage.getItem('geoFencing') !== 'false';
      const savedLocationRadius = localStorage.getItem('locationRadius') || '100';

      applyTheme(savedTheme);
      state.alertsEnabled = savedAlertsEnabled;
      state.biometricEnabled = savedBiometricEnabled;
      state.systemMonitoring = savedSystemMonitoring;
      state.locationSettings.gpsEnabled = savedGpsEnabled;
      state.locationSettings.geoFencing = savedGeoFencing;
      state.locationSettings.locationRadius = parseInt(savedLocationRadius);

      document.getElementById('alertsToggle').checked = savedAlertsEnabled;
      document.getElementById('biometricToggle').checked = savedBiometricEnabled;
      document.getElementById('systemToggle').checked = savedSystemMonitoring;
      document.getElementById('gpsToggle').checked = savedGpsEnabled;
      document.getElementById('geoFenceToggle').checked = savedGeoFencing;
      document.getElementById('radiusSlider').value = savedLocationRadius;
      document.getElementById('radiusValue').textContent = savedLocationRadius + 'm';

      // Show biometric screen first
      document.getElementById('biometricScreen').classList.remove('hidden');
      document.getElementById('appHeader').classList.add('hidden');
      document.getElementById('screen').classList.add('hidden');

      state.view = 'dashboard';
      render();

      // Start real-time simulation
      simulateRealTimeUpdates();
    })();
</script>
</body>
</html>
