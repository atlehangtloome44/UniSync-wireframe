<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UniSync — Student Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root{
          /* Student-friendly color palette */
          --bg-1:240 249 255;
          --bg-2:219 234 254;
          --surface:255 255 255;
          --card:239 246 255;
          --ink:15 23 42;
          --muted:71 85 105;
          --accent:59 130 246;
          --accent-2:37 99 235;
          --success:34 197 94;
          --warn:251 191 36;
          --danger:239 68 68;
          --ring:59 130 246;
        }
        .glass{backdrop-filter:blur(12px);background:rgba(255,255,255,.7)}
        .elevate{box-shadow:0 8px 24px rgba(0,0,0,.08)}
        .elevate-strong{box-shadow:0 16px 40px rgba(0,0,0,.15)}
        .animate-press{transition:transform .15s ease, opacity .15s ease}
        .ripple:active{transform:scale(0.98); opacity:0.9}
        @keyframes pulse{0%{transform:scale(1);opacity:.6}70%,100%{transform:scale(1.5);opacity:0}}
        .pulse-ring{position:relative}
        .pulse-ring::after{content:'';position:absolute;inset:-20px;border-radius:9999px;background:rgba(59,130,246,.3);animation:pulse 2s ease-out infinite;pointer-events:none}
        @keyframes slideInRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
        .notification-enter{animation:slideInRight 0.3s ease-out}
        @keyframes scanLine{0%{transform:translateY(-100%)}100%{transform:translateY(200px)}}
        .biometric-scan{position:relative;overflow:hidden}
        .biometric-scan::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgb(var(--accent-2)),transparent);animation:scanLine 2s ease-in-out infinite}
        @keyframes qrScan{0%{transform:translateY(-100%)}100%{transform:translateY(100%)}}
        .qr-scanner{position:relative;overflow:hidden}
        .qr-scanner::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,rgb(var(--success)),transparent);animation:qrScan 2s ease-in-out infinite}
        @keyframes bounce{0%,20%,53%,80%,100%{transform:translateY(0)}40%,43%{transform:translateY(-10px)}}
        .bounce{animation:bounce 1s ease-in-out}
        @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        .spin{animation:spin 1s linear infinite}
        .offline-indicator{background:linear-gradient(45deg,#f59e0b,#d97706);animation:pulse 2s infinite}
        .online-indicator{background:linear-gradient(45deg,#10b981,#059669);animation:pulse 2s infinite}
        .sync-indicator{animation:spin 2s linear infinite}
        @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .fade-in-up{animation:fadeInUp 0.5s ease-out}
        .notification-badge{animation:bounce 2s infinite}
    </style>
</head>
<body class="h-full bg-[rgb(var(--bg-1))] bg-gradient-to-br from-[rgb(var(--bg-1))] to-[rgb(var(--bg-2))] text-[rgb(var(--ink))] antialiased" style="font-family: Roboto, system-ui, -apple-system, Segoe UI, Helvetica, Arial;">
<div class="min-h-screen flex items-center justify-center p-4">
    <!-- Phone frame -->
    <div id="frame" class="w-full max-w-sm h-[820px] md:h-[860px] rounded-[32px] bg-[rgb(var(--surface))] border border-white/40 elevate overflow-hidden relative">
        <!-- Status spacer + camera hole -->
        <div class="relative h-6">
            <div class="absolute left-1/2 -translate-x-1/2 top-1 w-16 h-3 rounded-full bg-black/10"></div>
        </div>

        <!-- Top App Bar -->
        <header id="appHeader" class="hidden px-5 pt-2 pb-3 sticky top-0 z-30 bg-[rgb(var(--surface))]/90 glass">
            <div class="flex items-center justify-between">
                <button id="backBtn" class="p-2 rounded-full bg-[rgb(var(--card))] hover:opacity-90 animate-press ripple hidden" onclick="goBack()">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 text-white grid place-items-center font-semibold relative">
                        <span id="userInitials">AS</span>
                        <div id="connectionStatus" class="absolute -top-1 -right-1 w-3 h-3 bg-[rgb(var(--success))] rounded-full online-indicator"></div>
                    </div>
                    <div>
                        <div id="headerTitle" class="text-lg font-semibold tracking-tight leading-none">UniSync Student</div>
                        <div class="text-[11px] text-black/50 flex items-center gap-1">
                            <span id="connectionText" class="text-[rgb(var(--success))]">Online</span>
                            <span id="syncStatus" class="text-black/40">• Synced</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="notificationBtn" class="p-2 rounded-full bg-[rgb(var(--card))] hover:opacity-90 animate-press ripple relative" onclick="showNotifications()">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
                        <div id="notificationBadge" class="hidden absolute -top-1 -right-1 w-5 h-5 bg-[rgb(var(--danger))] text-white text-xs rounded-full grid place-items-center notification-badge">3</div>
                    </button>
                    <button id="profileBtn" class="p-2 rounded-full bg-[rgb(var(--card))] hover:opacity-90 animate-press ripple" onclick="showProfile()">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Push Notifications -->
        <div id="notificationContainer" class="absolute top-20 left-4 right-4 z-50 space-y-2"></div>

        <!-- Main content -->
        <main id="screen" class="hidden px-5 pb-20 space-y-4 overflow-y-auto h-[calc(100%-120px)]"></main>

        <!-- QR Scanner Modal -->
        <div id="qrScannerModal" class="hidden absolute inset-0 bg-black z-60">
            <div class="relative h-full flex flex-col">
                <!-- Scanner Header -->
                <div class="p-4 bg-black/50 text-white flex items-center justify-between">
                    <h3 class="font-semibold">Scan QR Code</h3>
                    <button onclick="closeQRScanner()" class="p-2 rounded-full bg-white/20 hover:bg-white/30">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/>
                        </svg>
                    </button>
                </div>

                <!-- Scanner Area -->
                <div class="flex-1 relative flex items-center justify-center">
                    <div class="w-64 h-64 border-2 border-white rounded-2xl relative qr-scanner">
                        <!-- Corner brackets -->
                        <div class="absolute top-0 left-0 w-8 h-8 border-l-4 border-t-4 border-[rgb(var(--success))] rounded-tl-lg"></div>
                        <div class="absolute top-0 right-0 w-8 h-8 border-r-4 border-t-4 border-[rgb(var(--success))] rounded-tr-lg"></div>
                        <div class="absolute bottom-0 left-0 w-8 h-8 border-l-4 border-b-4 border-[rgb(var(--success))] rounded-bl-lg"></div>
                        <div class="absolute bottom-0 right-0 w-8 h-8 border-r-4 border-b-4 border-[rgb(var(--success))] rounded-br-lg"></div>

                        <!-- QR Code placeholder -->
                        <div class="absolute inset-4 bg-white/10 rounded-lg flex items-center justify-center">
                            <svg class="w-16 h-16 text-white/50" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H9V11M15,11H17V13H15V11M19,5H21V9H19V5M5,5H9V9H5V5M3,19H5V21H3V19M5,19H9V21H5V19M11,19H13V21H11V19M15,19H21V21H15V19M19,11H21V15H19V11M19,15H21V19H19V15Z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Scanner Instructions -->
                <div class="p-4 bg-black/50 text-white text-center">
                    <div id="scannerStatus" class="font-medium mb-2">Position QR code within the frame</div>
                    <div class="text-sm opacity-75 flex items-center justify-center gap-2">
                        <div id="offlineMode" class="hidden flex items-center gap-1">
                            <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
                            <span>Offline Mode - Will sync when connected</span>
                        </div>
                        <div id="onlineMode" class="flex items-center gap-1">
                            <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                            <span>Online - Real-time sync</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Biometric Login Screen -->
        <div id="biometricScreen" class="absolute inset-0 bg-gradient-to-br from-[rgb(var(--bg-1))] to-[rgb(var(--bg-2))] z-60 flex items-center justify-center p-6">
            <div class="w-full max-w-sm space-y-6 text-center">
                <!-- Logo -->
                <div class="flex items-center justify-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 text-white grid place-items-center font-bold text-base shadow-md">
                        US
                    </div>
                    <div class="text-left">
                        <div class="text-lg font-bold text-gray-800">UniSync</div>
                        <div class="text-xs text-gray-600">Student Portal</div>
                    </div>
                </div>



                <!-- Biometric Scanner -->
                <div class="relative">
                    <div id="fingerprintButton" class="w-32 h-32 mx-auto rounded-full bg-white shadow-xl flex items-center justify-center cursor-pointer pulse-ring biometric-scan border-2 border-[rgb(var(--accent))/30]" onclick="startBiometricScan()">
                        <svg class="w-16 h-16 text-[rgb(var(--accent-2))]" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 3 12.01 3c-1.98 0-3.86.47-5.57 1.41-.24.13-.54.04-.68-.2-.13-.24-.04-.55.2-.68C7.82 2.52 9.86 2 12.01 2c2.13 0 3.99.47 6.03 1.52.25.13.34.43.21.67-.09.18-.26.28-.44.28zM3.5 9.72c-.1 0-.2-.03-.29-.09-.23-.16-.28-.47-.12-.7.99-1.4 2.25-2.5 3.75-3.27C9.98 4.04 14 4.03 17.15 5.65c1.5.77 2.76 1.86 3.75 3.27.16.22.11.54-.12.7-.23.16-.54.11-.7-.12-.9-1.29-2.04-2.25-3.39-2.94-2.87-1.47-6.54-1.47-9.4.01-1.36.7-2.5 1.65-3.4 2.94-.08.14-.23.21-.39.21z"/>
                            <path d="M9.75 21.79c-.13 0-.26-.05-.35-.15-.87-.87-1.34-1.43-2.01-2.64-.69-1.24-1.16-2.45-1.38-3.50-.25-1.19-.28-2.46-.02-3.64.24-1.07.7-2.04 1.33-2.79.59-.70 1.42-1.29 2.39-1.70.03-.01.06-.02.09-.02.79-.22 1.63-.33 2.49-.33s1.70.11 2.49.33c.03 0 .06.01.09.02.97.41 1.80 1.00 2.39 1.70.63.75 1.09 1.72 1.33 2.79.26 1.18.23 2.45-.02 3.64-.22 1.05-.69 2.26-1.38 3.50-.67 1.21-1.14 1.77-2.01 2.64-.18.18-.47.18-.65 0z"/>
                        </svg>
                    </div>

                    <!-- Success Animation -->
                    <div id="successAnimation" class="hidden absolute inset-0 w-32 h-32 mx-auto rounded-full bg-green-500 flex items-center justify-center shadow-xl border-2 border-green-200">
                        <svg class="w-16 h-16 text-white" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="space-y-1">
                    <h2 id="biometricTitle" class="text-2xl font-bold text-gray-800">Student Login</h2>
                    <p id="biometricSubtitle" class="text-gray-600">Touch the sensor to authenticate</p>
                </div>

                <!-- Status -->
                <div id="biometricStatus" class="text-sm text-gray-500 bg-white/40 backdrop-blur-sm rounded-full px-4 py-2 mx-auto inline-block">
                    Place your finger on the sensor
                </div>

                <!-- Alternative Login -->
                <button id="altLoginBtn" onclick="showPasswordLogin()" class="text-[rgb(var(--accent-2))] text-sm underline font-medium hover:opacity-80 transition-colors">
                    Use password instead
                </button>

                <!-- Password Login (Hidden) -->
                <div id="passwordLogin" class="hidden space-y-4">
                    <div class="space-y-3">
                        <input type="email" value="alice.smith@student.ac.za" class="w-full p-3 rounded-xl border border-[rgb(var(--accent))/30] text-center bg-white shadow-sm text-gray-700 text-sm" readonly>
                        <div class="relative">
                            <input type="password" id="loginPassword" placeholder="Enter your password" class="w-full p-3 pr-10 rounded-xl border border-[rgb(var(--accent))/30] text-center bg-white shadow-sm text-sm">
                            <button type="button" onclick="togglePassword()" class="absolute right-3 top-3 p-1 text-gray-400 hover:text-gray-600">
                                <svg id="eyeIcon" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button onclick="passwordLogin()" class="w-full p-3 rounded-xl bg-[rgb(var(--accent-2))] text-white font-semibold animate-press ripple shadow-md hover:opacity-90 transition-colors">
                        Login
                    </button>
                    <button onclick="showBiometricLogin()" class="text-[rgb(var(--accent-2))] text-sm underline font-medium hover:opacity-80 transition-colors">
                        Back to biometric
                    </button>
                </div>
            </div>
        </div>

        <!-- Notifications Panel -->
        <div id="notificationsPanel" class="hidden absolute inset-x-0 bottom-0 max-h-[70%] rounded-t-3xl bg-[rgb(var(--surface))] elevate overflow-hidden z-40">
            <div class="px-4 py-3 border-b border-black/10 flex items-center justify-between">
                <h3 class="font-semibold">Notifications</h3>
                <button class="p-2 rounded-full hover:bg-black/5 animate-press ripple" onclick="closeNotifications()">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/></svg>
                </button>
            </div>
            <div id="notificationsList" class="p-4 space-y-3 overflow-y-auto max-h-[calc(70vh-60px)]">
                <!-- Notifications will be populated here -->
            </div>
        </div>

        <!-- Profile Panel -->
        <div id="profilePanel" class="hidden absolute inset-x-0 bottom-0 max-h-[80%] rounded-t-3xl bg-[rgb(var(--surface))] elevate overflow-hidden z-40">
            <div class="px-4 py-3 border-b border-black/10 flex items-center justify-between">
                <h3 class="font-semibold">Profile</h3>
                <button class="p-2 rounded-full hover:bg-black/5 animate-press ripple" onclick="closeProfile()">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/></svg>
                </button>
            </div>
            <div class="p-4 space-y-4 overflow-y-auto max-h-[calc(80vh-60px)]">
                <div class="text-center">
                    <div class="w-20 h-20 rounded-3xl bg-gradient-to-br from-blue-500 to-blue-600 text-white text-2xl font-bold grid place-items-center mx-auto mb-3">AS</div>
                    <div class="font-semibold text-lg">Alice Smith</div>
                    <div class="text-sm text-black/60">Computer Science • 3rd Year</div>
                    <div class="text-xs text-black/50 mt-1">Student ID: CS2021001</div>
                </div>

                <div class="space-y-3">
                    <div class="rounded-2xl bg-[rgb(var(--card))] p-3">
                        <div class="text-sm font-medium mb-2">Academic Information</div>
                        <div class="space-y-1 text-xs text-black/60">
                            <div>Email: alice.smith@student.ac.za</div>
                            <div>Department: Computer Science</div>
                            <div>Year: 3rd Year</div>
                            <div>GPA: 3.8/4.0</div>
                        </div>
                    </div>

                    <div class="rounded-2xl bg-[rgb(var(--card))] p-3">
                        <div class="text-sm font-medium mb-2">Attendance Stats</div>
                        <div class="grid grid-cols-2 gap-3 text-center">
                            <div>
                                <div class="text-lg font-bold text-[rgb(var(--success))]">87%</div>
                                <div class="text-xs text-black/60">Overall</div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-[rgb(var(--accent-2))]">23</div>
                                <div class="text-xs text-black/60">This Month</div>
                            </div>
                        </div>
                    </div>

                    <button onclick="logout()" class="w-full p-3 rounded-xl bg-[rgb(var(--danger))] text-white font-medium animate-press ripple">
                        Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="hidden absolute left-1/2 -translate-x-1/2 bottom-28 px-4 py-2 rounded-full text-white bg-[rgb(var(--accent-2))] elevate">Message sent!</div>

        <!-- Bottom Navigation -->
        <nav id="bottomNav" class="hidden absolute bottom-0 left-0 right-0 bg-[rgb(var(--surface))]/90 glass border-t border-white/20 px-4 py-2">
            <div class="flex items-center justify-around">
                <button onclick="showDashboard()" class="flex flex-col items-center gap-1 p-2 rounded-xl hover:bg-black/5 animate-press ripple" id="navDashboard">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                    <span class="text-xs">Home</span>
                </button>
                <button onclick="showSchedule()" class="flex flex-col items-center gap-1 p-2 rounded-xl hover:bg-black/5 animate-press ripple" id="navSchedule">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>
                    <span class="text-xs">Schedule</span>
                </button>
                <button onclick="openQRScanner()" class="w-14 h-14 rounded-2xl bg-[rgb(var(--accent-2))] text-white flex items-center justify-center shadow-lg animate-press ripple">
                    <svg class="w-7 h-7" viewBox="0 0 24 24" fill="currentColor"><path d="M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H9V11M15,11H17V13H15V11M19,5H21V9H19V5M5,5H9V9H5V5M3,19H5V21H3V19M5,19H9V21H5V19M11,19H13V21H11V19M15,19H21V21H15V19M19,11H21V15H19V11M19,15H21V19H19V15Z"/></svg>
                </button>
                <button onclick="showAttendance()" class="flex flex-col items-center gap-1 p-2 rounded-xl hover:bg-black/5 animate-press ripple" id="navAttendance">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                    <span class="text-xs">Records</span>
                </button>
                <button onclick="showSettings()" class="flex flex-col items-center gap-1 p-2 rounded-xl hover:bg-black/5 animate-press ripple" id="navSettings">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94a1.5 1.5 0 000-1.88l1.38-1.07-1.5-2.6-1.7.35a5.53 5.53 0 00-1.6-.93l-.35-1.7h-3l-.35 1.7a5.53 5.53 0 00-1.6.93l-1.7-.35-1.5 2.6 1.38 1.07a1.5 1.5 0 000 1.88L4.27 14l1.5 2.6 1.7-.35c.47.4 1.02.72 1.6.93l.35 1.7h3l.35-1.7c.58-.21 1.13-.53 1.6-.93l1.7.35 1.5-2.6-1.38-1.06zM12 14.5A2.5 2.5 0 1114.5 12 2.5 2.5 0 0112 14.5z"/></svg>
                    <span class="text-xs">Settings</span>
                </button>
            </div>
        </nav>
    </div>
</div>

<script>
    // State Management
    const state = {
      view: 'dashboard',
      isOnline: navigator.onLine,
      user: {
        name: 'Alice Smith',
        email: 'alice.smith@student.ac.za',
        studentId: 'CS2021001',
        department: 'Computer Science',
        year: '3rd Year',
        gpa: '3.8/4.0',
        initials: 'AS'
      },
      pendingScans: JSON.parse(localStorage.getItem('pendingScans') || '[]'),
      attendanceRecords: JSON.parse(localStorage.getItem('attendanceRecords') || '[]'),
      notifications: [
        { id: 1, type: 'attendance', title: 'Attendance Reminder', message: 'Data Structures lecture starts in 15 minutes', time: '5 min ago', read: false },
        { id: 2, type: 'sync', title: 'Sync Complete', message: '3 attendance records synced successfully', time: '1 hour ago', read: false },
        { id: 3, type: 'schedule', title: 'Schedule Update', message: 'Computer Networks lab moved to Room 204', time: '2 hours ago', read: true }
      ],
      schedule: [
        { id: 1, subject: 'Data Structures', time: '09:00 - 10:30', room: 'Room 101', lecturer: 'Dr. Smith', status: 'upcoming' },
        { id: 2, subject: 'Computer Networks', time: '11:00 - 12:30', room: 'Room 204', lecturer: 'Prof. Johnson', status: 'upcoming' },
        { id: 3, subject: 'Database Systems', time: '14:00 - 15:30', room: 'Room 105', lecturer: 'Dr. Wilson', status: 'completed' }
      ],
      lastSync: new Date().toISOString(),
      syncInProgress: false
    };

    // DOM Elements
    const screen = document.getElementById('screen');
    const headerTitle = document.getElementById('headerTitle');
    const backBtn = document.getElementById('backBtn');
    const connectionStatus = document.getElementById('connectionStatus');
    const connectionText = document.getElementById('connectionText');
    const syncStatus = document.getElementById('syncStatus');
    const notificationBadge = document.getElementById('notificationBadge');

    // Biometric Authentication Functions
    function startBiometricScan() {
      if (navigator.vibrate) {
        navigator.vibrate(200);
      }

      const fingerprintBtn = document.getElementById('fingerprintButton');
      const successAnim = document.getElementById('successAnimation');
      const status = document.getElementById('biometricStatus');
      const title = document.getElementById('biometricTitle');
      const subtitle = document.getElementById('biometricSubtitle');

      fingerprintBtn.style.transform = 'scale(0.95)';
      fingerprintBtn.style.opacity = '0.8';
      status.textContent = 'Scanning fingerprint...';
      status.className = 'text-sm text-[rgb(var(--accent-2))]';

      setTimeout(() => {
        fingerprintBtn.classList.add('hidden');
        successAnim.classList.remove('hidden');

        if (navigator.vibrate) {
          navigator.vibrate([100, 50, 100]);
        }

        title.textContent = 'Welcome Back!';
        subtitle.textContent = 'Authentication successful';
        status.textContent = `Welcome, ${state.user.name}`;
        status.className = 'text-sm text-[rgb(var(--success))] font-medium';

        setTimeout(() => {
          document.getElementById('biometricScreen').classList.add('hidden');
          document.getElementById('appHeader').classList.remove('hidden');
          document.getElementById('screen').classList.remove('hidden');
          document.getElementById('bottomNav').classList.remove('hidden');
          showPushNotification('Login successful', 'Welcome back to UniSync!');
          checkPendingAttendance();
        }, 2000);
      }, 2000);
    }

    function showPasswordLogin() {
      document.getElementById('fingerprintButton').parentElement.classList.add('hidden');
      document.getElementById('biometricTitle').textContent = 'Student Login';
      document.getElementById('biometricSubtitle').textContent = 'Enter your credentials';
      document.getElementById('biometricStatus').classList.add('hidden');
      document.getElementById('altLoginBtn').classList.add('hidden');
      document.getElementById('passwordLogin').classList.remove('hidden');
    }

    function showBiometricLogin() {
      document.getElementById('fingerprintButton').parentElement.classList.remove('hidden');
      document.getElementById('biometricTitle').textContent = 'Student Login';
      document.getElementById('biometricSubtitle').textContent = 'Touch the sensor to authenticate';
      document.getElementById('biometricStatus').classList.remove('hidden');
      document.getElementById('altLoginBtn').classList.remove('hidden');
      document.getElementById('passwordLogin').classList.add('hidden');
    }

    function passwordLogin() {
      const password = document.getElementById('loginPassword').value;
      if (!password) {
        showToast('Please enter your password');
        return;
      }

      const status = document.getElementById('biometricStatus');
      status.classList.remove('hidden');
      status.textContent = 'Verifying credentials...';
      status.className = 'text-sm text-[rgb(var(--accent-2))]';

      setTimeout(() => {
        status.textContent = 'Login successful!';
        status.className = 'text-sm text-[rgb(var(--success))] font-medium';

        setTimeout(() => {
          document.getElementById('biometricScreen').classList.add('hidden');
          document.getElementById('appHeader').classList.remove('hidden');
          document.getElementById('screen').classList.remove('hidden');
          document.getElementById('bottomNav').classList.remove('hidden');
          showPushNotification('Login successful', 'Welcome back to UniSync!');
          checkPendingAttendance();
        }, 1500);
      }, 1500);
    }

    function togglePassword() {
      const passwordInput = document.getElementById('loginPassword');
      const eyeIcon = document.getElementById('eyeIcon');

      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeIcon.innerHTML = '<path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>';
      } else {
        passwordInput.type = 'password';
        eyeIcon.innerHTML = '<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';
      }
    }

    // Connection Status Management
    function updateConnectionStatus() {
      state.isOnline = navigator.onLine;

      if (state.isOnline) {
        connectionStatus.className = 'absolute -top-1 -right-1 w-3 h-3 bg-[rgb(var(--success))] rounded-full online-indicator';
        connectionText.textContent = 'Online';
        connectionText.className = 'text-[rgb(var(--success))]';
        document.getElementById('onlineMode').classList.remove('hidden');
        document.getElementById('offlineMode').classList.add('hidden');

        // Auto-sync when coming back online
        if (state.pendingScans.length > 0) {
          syncPendingAttendance();
        }
      } else {
        connectionStatus.className = 'absolute -top-1 -right-1 w-3 h-3 bg-[rgb(var(--warn))] rounded-full offline-indicator';
        connectionText.textContent = 'Offline';
        connectionText.className = 'text-[rgb(var(--warn))]';
        document.getElementById('onlineMode').classList.add('hidden');
        document.getElementById('offlineMode').classList.remove('hidden');
      }

      updateSyncStatus();
    }

    function updateSyncStatus() {
      if (state.syncInProgress) {
        syncStatus.innerHTML = '• <span class="sync-indicator">⟳</span> Syncing...';
      } else if (state.pendingScans.length > 0) {
        syncStatus.textContent = `• ${state.pendingScans.length} pending`;
        syncStatus.className = 'text-[rgb(var(--warn))]';
      } else {
        syncStatus.textContent = '• Synced';
        syncStatus.className = 'text-black/40';
      }
    }

    // QR Scanner Functions
    function openQRScanner() {
      document.getElementById('qrScannerModal').classList.remove('hidden');
      updateConnectionStatus();

      // Simulate QR scanning after 3 seconds
      setTimeout(() => {
        simulateQRScan();
      }, 3000);
    }

    function closeQRScanner() {
      document.getElementById('qrScannerModal').classList.add('hidden');
    }

    function simulateQRScan() {
      const scannerStatus = document.getElementById('scannerStatus');
      scannerStatus.textContent = 'QR Code detected! Processing...';

      if (navigator.vibrate) {
        navigator.vibrate([200, 100, 200]);
      }

      setTimeout(() => {
        const attendanceData = {
          id: Date.now(),
          subject: 'Data Structures',
          lecturer: 'Dr. Smith',
          room: 'Room 101',
          timestamp: new Date().toISOString(),
          location: { lat: -26.2041, lng: 28.0473 }, // Johannesburg coordinates
          synced: state.isOnline
        };

        if (state.isOnline) {
          // Online: immediate sync
          state.attendanceRecords.push(attendanceData);
          localStorage.setItem('attendanceRecords', JSON.stringify(state.attendanceRecords));
          scannerStatus.textContent = 'Attendance recorded successfully!';
          showToast('Attendance recorded and synced!');
          showPushNotification('Attendance Recorded', `${attendanceData.subject} - ${attendanceData.room}`);
        } else {
          // Offline: store locally
          attendanceData.synced = false;
          state.pendingScans.push(attendanceData);
          localStorage.setItem('pendingScans', JSON.stringify(state.pendingScans));
          scannerStatus.textContent = 'Attendance saved locally - will sync when online';
          showToast('Attendance saved offline!');
          showPushNotification('Attendance Saved Offline', 'Will sync when connection is restored');
          updateSyncStatus();
        }

        setTimeout(() => {
          closeQRScanner();
        }, 2000);
      }, 1500);
    }

    // Sync Functions
    function syncPendingAttendance() {
      if (!state.isOnline || state.pendingScans.length === 0) return;

      state.syncInProgress = true;
      updateSyncStatus();

      setTimeout(() => {
        // Move pending scans to attendance records
        state.attendanceRecords.push(...state.pendingScans.map(scan => ({
          ...scan,
          synced: true,
          syncedAt: new Date().toISOString()
        })));

        const syncedCount = state.pendingScans.length;
        state.pendingScans = [];
        state.syncInProgress = false;
        state.lastSync = new Date().toISOString();

        // Update localStorage
        localStorage.setItem('attendanceRecords', JSON.stringify(state.attendanceRecords));
        localStorage.setItem('pendingScans', JSON.stringify(state.pendingScans));

        updateSyncStatus();
        showToast(`${syncedCount} records synced successfully!`);
        showPushNotification('Sync Complete', `${syncedCount} attendance records synced`);

        // Add sync notification
        addNotification({
          type: 'sync',
          title: 'Sync Complete',
          message: `${syncedCount} attendance records synced successfully`,
          time: 'Just now'
        });
      }, 2000);
    }

    // Push Notifications
    function showPushNotification(title, message, type = 'info') {
      const container = document.getElementById('notificationContainer');
      const notificationId = 'notification-' + Date.now();

      const typeStyles = {
        info: 'bg-[rgb(var(--accent-2))] text-white',
        success: 'bg-[rgb(var(--success))] text-white',
        warning: 'bg-[rgb(var(--warn))] text-white',
        danger: 'bg-[rgb(var(--danger))] text-white'
      };

      const notification = document.createElement('div');
      notification.id = notificationId;
      notification.className = `p-3 rounded-xl ${typeStyles[type]} elevate notification-enter flex items-start gap-3 text-sm`;
      notification.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
          </svg>
        </div>
        <div class="flex-1">
          <div class="font-medium">${title}</div>
          <div class="text-sm opacity-90">${message}</div>
        </div>
        <button onclick="dismissNotification('${notificationId}')" class="p-1 rounded-full hover:bg-white/20 flex-shrink-0">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811z"/>
          </svg>
        </button>
      `;

      container.appendChild(notification);

      if (navigator.vibrate) {
        navigator.vibrate(200);
      }

      setTimeout(() => {
        dismissNotification(notificationId);
      }, 5000);
    }

    function dismissNotification(notificationId) {
      const notification = document.getElementById(notificationId);
      if (notification) {
        notification.style.transform = 'translateX(100%)';
        notification.style.opacity = '0';
        setTimeout(() => {
          notification.remove();
        }, 300);
      }
    }

    // Notification Management
    function addNotification(notification) {
      notification.id = Date.now();
      notification.read = false;
      notification.time = notification.time || 'Just now';
      state.notifications.unshift(notification);
      updateNotificationBadge();
    }

    function updateNotificationBadge() {
      const unreadCount = state.notifications.filter(n => !n.read).length;
      if (unreadCount > 0) {
        notificationBadge.textContent = unreadCount;
        notificationBadge.classList.remove('hidden');
      } else {
        notificationBadge.classList.add('hidden');
      }
    }

    function checkPendingAttendance() {
      // Simulate checking for upcoming classes
      setTimeout(() => {
        const upcomingClass = state.schedule.find(s => s.status === 'upcoming');
        if (upcomingClass) {
          showPushNotification(
            'Upcoming Class',
            `${upcomingClass.subject} starts in 15 minutes - ${upcomingClass.room}`,
            'info'
          );

          addNotification({
            type: 'attendance',
            title: 'Attendance Reminder',
            message: `${upcomingClass.subject} lecture starts in 15 minutes`,
            time: 'Just now'
          });
        }
      }, 3000);
    }

    // Screen Functions
    function dashboardScreen() {
      headerTitle.textContent = 'UniSync Student';
      backBtn.classList.add('hidden');
      updateNavigation('dashboard');

      const todayClasses = state.schedule.filter(s => s.status === 'upcoming').length;
      const completedToday = state.schedule.filter(s => s.status === 'completed').length;
      const attendanceRate = Math.round((completedToday / (todayClasses + completedToday)) * 100) || 0;

      return `
        <div class="space-y-4">
          <!-- Welcome Banner -->
          <div class="rounded-3xl bg-gradient-to-r from-[rgb(var(--accent))] to-[rgb(var(--accent-2))] p-4 text-white">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-sm opacity-90">Welcome back,</div>
                <div class="font-semibold text-lg">${state.user.name}</div>
                <div class="text-sm opacity-75">${state.user.department} • ${state.user.year}</div>
              </div>
              <div class="text-right">
                <div class="text-2xl font-bold">${attendanceRate}%</div>
                <div class="text-sm opacity-90">Today's Rate</div>
              </div>
            </div>
          </div>

          <!-- Quick Stats -->
          <div class="grid grid-cols-3 gap-3">
            <div class="rounded-2xl bg-white p-4 elevate text-center">
              <div class="text-2xl font-bold text-[rgb(var(--success))]">${completedToday}</div>
              <div class="text-xs text-black/60">Attended</div>
              <div class="text-xs text-[rgb(var(--success))] mt-1">Today</div>
            </div>
            <div class="rounded-2xl bg-white p-4 elevate text-center">
              <div class="text-2xl font-bold text-[rgb(var(--accent-2))]">${todayClasses}</div>
              <div class="text-xs text-black/60">Remaining</div>
              <div class="text-xs text-[rgb(var(--accent))] mt-1">Classes</div>
            </div>
            <div class="rounded-2xl bg-white p-4 elevate text-center">
              <div class="text-2xl font-bold text-[rgb(var(--warn))]">${state.pendingScans.length}</div>
              <div class="text-xs text-black/60">Pending</div>
              <div class="text-xs text-[rgb(var(--warn))] mt-1">Sync</div>
            </div>
          </div>

          <!-- Connection Status -->
          <div class="rounded-2xl ${state.isOnline ? 'bg-green-50' : 'bg-yellow-50'} p-3 elevate">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-full ${state.isOnline ? 'bg-[rgb(var(--success))]' : 'bg-[rgb(var(--warn))]'} text-white flex items-center justify-center">
                ${state.isOnline ?
                  '<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.07 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg>' :
                  '<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7L12 21.5 23.64 7zM3.53 10.95l8.47 8.47 8.47-8.47c-2.76-2.76-7.24-2.76-10 0L12 9.41l-1.53 1.54c-2.76 2.76-7.24 2.76-10 0z"/></svg>'
                }
              </div>
              <div>
                <div class="font-medium text-sm">${state.isOnline ? 'Connected' : 'Offline Mode'}</div>
                <div class="text-xs text-black/60">
                  ${state.isOnline ?
                    'Real-time sync enabled' :
                    `${state.pendingScans.length} records will sync when connected`
                  }
                </div>
              </div>
              ${!state.isOnline && state.pendingScans.length > 0 ?
                '<button onclick="syncPendingAttendance()" class="px-3 py-1.5 rounded-lg bg-[rgb(var(--warn))] text-white text-xs font-medium animate-press ripple">Retry Sync</button>' :
                ''
              }
            </div>
          </div>

          <!-- Today's Schedule -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Today's Schedule</h3>
              <button onclick="showSchedule()" class="text-[rgb(var(--accent-2))] text-sm font-medium">View All</button>
            </div>
            <div class="space-y-3">
              ${state.schedule.slice(0, 3).map(class_ => `
                <div class="flex items-center justify-between p-3 rounded-2xl ${class_.status === 'completed' ? 'bg-green-50' : 'bg-[rgb(var(--card))]'}">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-2xl ${class_.status === 'completed' ? 'bg-[rgb(var(--success))]' : 'bg-[rgb(var(--accent-2))]'} text-white text-xs grid place-items-center">
                      ${class_.status === 'completed' ?
                        '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' :
                        class_.subject.substring(0, 2)
                      }
                    </div>
                    <div>
                      <div class="font-medium text-sm">${class_.subject}</div>
                      <div class="text-xs text-black/60">${class_.time} • ${class_.room}</div>
                      <div class="text-xs text-black/50">${class_.lecturer}</div>
                    </div>
                  </div>
                  <div class="text-xs ${class_.status === 'completed' ? 'text-[rgb(var(--success))] font-medium' : 'text-black/50'}">
                    ${class_.status === 'completed' ? 'Attended' : 'Upcoming'}
                  </div>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="rounded-3xl bg-[rgb(var(--card))] p-4 elevate">
            <h3 class="font-semibold mb-3">Quick Actions</h3>
            <div class="grid grid-cols-2 gap-3">
              <button onclick="openQRScanner()" class="p-4 rounded-2xl bg-white text-center hover:opacity-90 animate-press ripple">
                <svg class="w-8 h-8 mx-auto mb-2 text-[rgb(var(--accent-2))]" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H9V11M15,11H17V13H15V11M19,5H21V9H19V5M5,5H9V9H5V5M3,19H5V21H3V19M5,19H9V21H5V19M11,19H13V21H11V19M15,19H21V21H15V19M19,11H21V15H19V11M19,15H21V19H19V15Z"/>
                </svg>
                <div class="font-medium text-sm">Scan QR</div>
                <div class="text-xs text-black/60">Mark Attendance</div>
              </button>
              <button onclick="showAttendance()" class="p-4 rounded-2xl bg-white text-center hover:opacity-90 animate-press ripple">
                <svg class="w-8 h-8 mx-auto mb-2 text-[rgb(var(--success))]" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                </svg>
                <div class="font-medium text-sm">Records</div>
                <div class="text-xs text-black/60">View History</div>
              </button>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Recent Activity</h3>
            <div class="space-y-3">
              ${[...state.attendanceRecords, ...state.pendingScans].slice(-3).reverse().map(record => `
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-2 h-2 rounded-full ${record.synced ? 'bg-[rgb(var(--success))]' : 'bg-[rgb(var(--warn))]'}"></div>
                    <div>
                      <div class="font-medium text-sm">${record.subject}</div>
                      <div class="text-xs text-black/60">${record.room} • ${record.lecturer}</div>
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="text-xs text-black/50">${new Date(record.timestamp).toLocaleTimeString()}</div>
                    <div class="text-xs ${record.synced ? 'text-[rgb(var(--success))]' : 'text-[rgb(var(--warn))]'}">
                      ${record.synced ? 'Synced' : 'Pending'}
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function scheduleScreen() {
      headerTitle.textContent = 'Class Schedule';
      backBtn.classList.remove('hidden');
      updateNavigation('schedule');

      return `
        <div class="space-y-4">
          <!-- Date Header -->
          <div class="rounded-2xl bg-white p-4 elevate text-center">
            <div class="text-lg font-semibold">${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
            <div class="text-sm text-black/60 mt-1">${state.schedule.length} classes scheduled</div>
          </div>

          <!-- Schedule List -->
          <div class="space-y-3">
            ${state.schedule.map(class_ => `
              <div class="rounded-2xl bg-white p-4 elevate">
                <div class="flex items-start justify-between">
                  <div class="flex items-start gap-3 flex-1">
                    <div class="w-12 h-12 rounded-2xl ${class_.status === 'completed' ? 'bg-[rgb(var(--success))]' : 'bg-[rgb(var(--accent-2))]'} text-white font-medium grid place-items-center">
                      ${class_.status === 'completed' ?
                        '<svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' :
                        class_.subject.substring(0, 2)
                      }
                    </div>
                    <div class="flex-1">
                      <div class="font-semibold">${class_.subject}</div>
                      <div class="text-sm text-black/60 mt-1">${class_.lecturer}</div>
                      <div class="flex items-center gap-4 mt-2 text-xs text-black/50">
                        <div class="flex items-center gap-1">
                          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm4.2 14.2L11 13V7h1.5v5.2l4.5 2.7-.8 1.3z"/>
                          </svg>
                          <span>${class_.time}</span>
                        </div>
                        <div class="flex items-center gap-1">
                          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                          </svg>
                          <span>${class_.room}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="text-xs px-2 py-1 rounded-full ${class_.status === 'completed' ? 'bg-green-100 text-[rgb(var(--success))]' : 'bg-blue-100 text-[rgb(var(--accent-2))]'} font-medium">
                      ${class_.status === 'completed' ? 'Attended' : 'Upcoming'}
                    </div>
                    ${class_.status === 'upcoming' ?
                      '<button onclick="openQRScanner()" class="mt-2 px-3 py-1.5 rounded-lg bg-[rgb(var(--accent-2))] text-white text-xs font-medium animate-press ripple">Mark Attendance</button>' :
                      ''
                    }
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function attendanceScreen() {
      headerTitle.textContent = 'Attendance Records';
      backBtn.classList.remove('hidden');
      updateNavigation('attendance');

      const allRecords = [...state.attendanceRecords, ...state.pendingScans].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      const totalRecords = allRecords.length;
      const syncedRecords = allRecords.filter(r => r.synced).length;
      const attendanceRate = totalRecords > 0 ? Math.round((syncedRecords / totalRecords) * 100) : 0;

      return `
        <div class="space-y-4">
          <!-- Stats Overview -->
          <div class="grid grid-cols-3 gap-3">
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-xl font-bold text-[rgb(var(--accent-2))]">${totalRecords}</div>
              <div class="text-xs text-black/60">Total</div>
              <div class="text-xs text-[rgb(var(--accent))] mt-1">Records</div>
            </div>
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-xl font-bold text-[rgb(var(--success))]">${syncedRecords}</div>
              <div class="text-xs text-black/60">Synced</div>
              <div class="text-xs text-[rgb(var(--success))] mt-1">Online</div>
            </div>
            <div class="rounded-2xl bg-white p-3 elevate text-center">
              <div class="text-xl font-bold text-[rgb(var(--warn))]">${state.pendingScans.length}</div>
              <div class="text-xs text-black/60">Pending</div>
              <div class="text-xs text-[rgb(var(--warn))] mt-1">Offline</div>
            </div>
          </div>

          <!-- Sync Status -->
          ${state.pendingScans.length > 0 ? `
            <div class="rounded-2xl bg-yellow-50 p-3 elevate">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full bg-[rgb(var(--warn))] text-white flex items-center justify-center">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                  </div>
                  <div>
                    <div class="font-medium text-sm">Sync Pending</div>
                    <div class="text-xs text-black/60">${state.pendingScans.length} records waiting to sync</div>
                  </div>
                </div>
                <button onclick="syncPendingAttendance()" class="px-3 py-1.5 rounded-lg bg-[rgb(var(--warn))] text-white text-xs font-medium animate-press ripple ${!state.isOnline ? 'opacity-50' : ''}">
                  ${state.isOnline ? 'Sync Now' : 'Offline'}
                </button>
              </div>
            </div>
          ` : ''}

          <!-- Records List -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Recent Records</h3>
            <div class="space-y-3">
              ${allRecords.length > 0 ? allRecords.map(record => `
                <div class="flex items-center justify-between p-3 rounded-2xl ${record.synced ? 'bg-green-50' : 'bg-yellow-50'}">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-2xl ${record.synced ? 'bg-[rgb(var(--success))]' : 'bg-[rgb(var(--warn))]'} text-white text-xs grid place-items-center">
                      ${record.synced ?
                        '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' :
                        '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>'
                      }
                    </div>
                    <div>
                      <div class="font-medium text-sm">${record.subject}</div>
                      <div class="text-xs text-black/60">${record.room} • ${record.lecturer}</div>
                      <div class="text-xs text-black/50 mt-1">${new Date(record.timestamp).toLocaleString()}</div>
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="text-xs px-2 py-1 rounded-full ${record.synced ? 'bg-green-100 text-[rgb(var(--success))]' : 'bg-yellow-100 text-[rgb(var(--warn))]'} font-medium">
                      ${record.synced ? 'Synced' : 'Pending'}
                    </div>
                    ${record.syncedAt ?
                      `<div class="text-xs text-black/50 mt-1">Synced: ${new Date(record.syncedAt).toLocaleTimeString()}</div>` :
                      ''
                    }
                  </div>
                </div>
              `).join('') : `
                <div class="text-center py-8 text-black/50">
                  <svg class="w-12 h-12 mx-auto mb-3 opacity-50" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                  </svg>
                  <div class="font-medium">No attendance records yet</div>
                  <div class="text-sm mt-1">Scan QR codes to start tracking attendance</div>
                </div>
              `}
            </div>
          </div>
        </div>
      `;
    }

    function settingsScreen() {
      headerTitle.textContent = 'Settings';
      backBtn.classList.remove('hidden');
      updateNavigation('settings');

      return `
        <div class="space-y-4">
          <!-- Profile Section -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Profile</h3>
            <div class="flex items-center gap-3 mb-4">
              <div class="w-16 h-16 rounded-3xl bg-gradient-to-br from-blue-500 to-blue-600 text-white text-xl font-bold grid place-items-center">${state.user.initials}</div>
              <div>
                <div class="font-semibold">${state.user.name}</div>
                <div class="text-sm text-black/60">${state.user.department} • ${state.user.year}</div>
                <div class="text-xs text-black/50">${state.user.email}</div>
              </div>
            </div>
            <button onclick="showProfile()" class="w-full p-3 rounded-xl bg-[rgb(var(--card))] font-medium animate-press ripple">
              View Full Profile
            </button>
          </div>

          <!-- App Settings -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">App Settings</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 rounded-2xl bg-[rgb(var(--card))]">
                <div>
                  <div class="font-medium">Push Notifications</div>
                  <div class="text-xs text-black/60">Get notified about upcoming classes</div>
                </div>
                <input type="checkbox" checked class="w-4 h-4">
              </div>
              <div class="flex items-center justify-between p-3 rounded-2xl bg-[rgb(var(--card))]">
                <div>
                  <div class="font-medium">Offline Mode</div>
                  <div class="text-xs text-black/60">Save attendance when offline</div>
                </div>
                <input type="checkbox" checked class="w-4 h-4">
              </div>
              <div class="flex items-center justify-between p-3 rounded-2xl bg-[rgb(var(--card))]">
                <div>
                  <div class="font-medium">Auto Sync</div>
                  <div class="text-xs text-black/60">Automatically sync when online</div>
                </div>
                <input type="checkbox" checked class="w-4 h-4">
              </div>
              <div class="flex items-center justify-between p-3 rounded-2xl bg-[rgb(var(--card))]">
                <div>
                  <div class="font-medium">Biometric Login</div>
                  <div class="text-xs text-black/60">Use fingerprint to login</div>
                </div>
                <input type="checkbox" checked class="w-4 h-4">
              </div>
            </div>
          </div>

          <!-- Data & Storage -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Data & Storage</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 rounded-2xl bg-[rgb(var(--card))]">
                <div>
                  <div class="font-medium">Local Storage</div>
                  <div class="text-xs text-black/60">${(JSON.stringify(state.attendanceRecords).length / 1024).toFixed(1)} KB used</div>
                </div>
                <button onclick="clearLocalData()" class="px-3 py-1.5 rounded-lg bg-[rgb(var(--danger))] text-white text-xs font-medium animate-press ripple">
                  Clear
                </button>
              </div>
              <div class="flex items-center justify-between p-3 rounded-2xl bg-[rgb(var(--card))]">
                <div>
                  <div class="font-medium">Export Data</div>
                  <div class="text-xs text-black/60">Download your attendance records</div>
                </div>
                <button onclick="exportData()" class="px-3 py-1.5 rounded-lg bg-[rgb(var(--accent-2))] text-white text-xs font-medium animate-press ripple">
                  Export
                </button>
              </div>
            </div>
          </div>

          <!-- Support -->
          <div class="rounded-3xl bg-white p-4 elevate">
            <h3 class="font-semibold mb-3">Support</h3>
            <div class="space-y-2">
              <button class="w-full p-3 rounded-2xl bg-[rgb(var(--card))] text-left hover:opacity-90 animate-press ripple">
                <div class="font-medium">Help & FAQ</div>
                <div class="text-xs text-black/60">Get answers to common questions</div>
              </button>
              <button class="w-full p-3 rounded-2xl bg-[rgb(var(--card))] text-left hover:opacity-90 animate-press ripple">
                <div class="font-medium">Contact Support</div>
                <div class="text-xs text-black/60">Get help from our support team</div>
              </button>
              <button class="w-full p-3 rounded-2xl bg-[rgb(var(--card))] text-left hover:opacity-90 animate-press ripple">
                <div class="font-medium">Report Issue</div>
                <div class="text-xs text-black/60">Report bugs or technical issues</div>
              </button>
            </div>
          </div>

          <!-- App Info -->
          <div class="rounded-3xl bg-[rgb(var(--card))] p-4 elevate text-center">
            <div class="text-sm font-medium">UniSync Student</div>
            <div class="text-xs text-black/60 mt-1">Version 2.1.0</div>
            <div class="text-xs text-black/50 mt-1">© 2024 University of Johannesburg</div>
          </div>
        </div>
      `;
    }

    // Navigation Functions
    function showDashboard() {
      state.view = 'dashboard';
      render();
    }

    function showSchedule() {
      state.view = 'schedule';
      render();
    }

    function showAttendance() {
      state.view = 'attendance';
      render();
    }

    function showSettings() {
      state.view = 'settings';
      render();
    }

    function goBack() {
      state.view = 'dashboard';
      render();
    }

    function updateNavigation(activeView) {
      const navButtons = ['navDashboard', 'navSchedule', 'navAttendance', 'navSettings'];
      navButtons.forEach(id => {
        const btn = document.getElementById(id);
        if (btn) {
          if (id.includes(activeView)) {
            btn.classList.add('text-[rgb(var(--accent-2))]');
          } else {
            btn.classList.remove('text-[rgb(var(--accent-2))]');
          }
        }
      });
    }

    // Panel Functions
    function showNotifications() {
      document.getElementById('notificationsPanel').classList.remove('hidden');
      renderNotifications();
      // Mark all as read
      state.notifications.forEach(n => n.read = true);
      updateNotificationBadge();
    }

    function closeNotifications() {
      document.getElementById('notificationsPanel').classList.add('hidden');
    }

    function renderNotifications() {
      const container = document.getElementById('notificationsList');
      container.innerHTML = state.notifications.map(notification => `
        <div class="p-3 rounded-2xl ${notification.read ? 'bg-gray-50' : 'bg-[rgb(var(--card))]'}">
          <div class="flex items-start gap-3">
            <div class="w-8 h-8 rounded-full ${
              notification.type === 'attendance' ? 'bg-blue-100 text-[rgb(var(--accent-2))]' :
              notification.type === 'sync' ? 'bg-green-100 text-[rgb(var(--success))]' :
              'bg-gray-100 text-gray-600'
            } flex items-center justify-center flex-shrink-0">
              ${notification.type === 'attendance' ?
                '<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>' :
                notification.type === 'sync' ?
                '<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>' :
                '<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>'
              }
            </div>
            <div class="flex-1">
              <div class="font-medium text-sm">${notification.title}</div>
              <div class="text-sm text-black/60 mt-1">${notification.message}</div>
              <div class="text-xs text-black/50 mt-2">${notification.time}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function showProfile() {
      document.getElementById('profilePanel').classList.remove('hidden');
    }

    function closeProfile() {
      document.getElementById('profilePanel').classList.add('hidden');
    }

    // Utility Functions
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    function clearLocalData() {
      if (confirm('Are you sure you want to clear all local data? This cannot be undone.')) {
        localStorage.removeItem('attendanceRecords');
        localStorage.removeItem('pendingScans');
        state.attendanceRecords = [];
        state.pendingScans = [];
        showToast('Local data cleared');
        render();
      }
    }

    function exportData() {
      const data = {
        attendanceRecords: state.attendanceRecords,
        pendingScans: state.pendingScans,
        exportDate: new Date().toISOString()
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `attendance-data-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);

      showToast('Data exported successfully');
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        // Clear sensitive data but keep attendance records
        localStorage.removeItem('userSession');
        location.reload();
      }
    }

    // Render Function
    function render() {
      if (state.view === 'dashboard') {
        screen.innerHTML = dashboardScreen();
      } else if (state.view === 'schedule') {
        screen.innerHTML = scheduleScreen();
      } else if (state.view === 'attendance') {
        screen.innerHTML = attendanceScreen();
      } else if (state.view === 'settings') {
        screen.innerHTML = settingsScreen();
      }
    }

    // Event Listeners
    window.addEventListener('online', () => {
      updateConnectionStatus();
      showPushNotification('Connection Restored', 'Back online - syncing data...', 'success');
    });

    window.addEventListener('offline', () => {
      updateConnectionStatus();
      showPushNotification('Connection Lost', 'Offline mode activated', 'warning');
    });

    // Initialize App
    (function init() {
      // Set user initials
      document.getElementById('userInitials').textContent = state.user.initials;

      // Update connection status
      updateConnectionStatus();
      updateNotificationBadge();

      // Show biometric screen first
      document.getElementById('biometricScreen').classList.remove('hidden');
      document.getElementById('appHeader').classList.add('hidden');
      document.getElementById('screen').classList.add('hidden');
      document.getElementById('bottomNav').classList.add('hidden');

      state.view = 'dashboard';
      render();
    })();
</script>
</body>
</html>
